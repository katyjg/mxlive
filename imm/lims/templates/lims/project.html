{% extends "base.html" %}

{% block content %}
{{ block.super }}
    <h2>Welcome, {{ user }}</h2>
    {% include "lims/project_help.html" %}
    <div class="content-list" id="inbox">
        {% comment %}
        The content for this div is loaded via ajax in the script block below.
        {% endcomment %}
    </div>
{% endblock %}

{% block sidebar %}
    {% include "lims/project_summary.html" %}   
    {{ block.super }} 
{% endblock %}

{% block script %}
{{ block.super }}
<script>
jQuery(function() {
    jQuery("#inbox").load("{% url lims-inbox %}", function() {});
    
    jQuery(function() {
        // handles all the '+ add' buttons.
        jQuery("a.modal").live("click", function() {
            var $button = jQuery(this);
            var contentURL = $button.attr("href");
            var $modal = jQuery($button.attr("rel"));
            // this attempts to preload the content
            if(!$modal.find("a.close").length) {
                $modal.append("<div class='content'></div>");
                $modal.append('<a href="#" class="close" id="close_x">close</a>');
            }

            $modal.find('.content').load(contentURL, function(e, status) {
                if(status === "success") {
                    $modal.lightbox_me({
                        centered: true,
                        destroyOnClose: false,
                        overlaySpeed: "fast",
                        overlayDisappearSpeed: "fast",
                        lightboxSpeed: "fast",
                        lightboxdisappearSpeed: "fast",
                        onLoad: function() {
                            // FIXME: find a better place for this
                            jQuery(".slideview").slideView();
                        },
                        onClose: function() {
                            // reload the relevant forms that have been updated
                            loadWidgets();
                            loadDatalists();
                        }
                    });
                }
            });
            return false;
        });
	});
});
</script>
{% endblock %}

