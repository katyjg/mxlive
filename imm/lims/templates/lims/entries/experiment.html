{% extends "base.html" %}
{% load humanize %}
{% load markup %}

{% block headline %}
<h2> <span class="identity {% if not object.is_editable %}locked{% endif %}">{{object.identity}}</span> {{object.name}}</h2>
{% endblock %}

{% block object-tools %}
<div class="object-tools">
    {% include "lims/tools.html" %}
</div>
{% endblock %}

{% block content %}

<div class="experiment droppable droppable-replace" {% if object.is_editable %}accept="crystal" title="Drag and drop onto this image"{% else %}accept=""{% endif %}></div>

<table class="entrysummary" cellpadding="2" cellspacing="0" border="0">
    <tr valign="top"><th>Status:</th><td>{{object.get_status_display}}</td></tr>
    <tr valign="top"><th>Type:</th><td>{{object.get_kind_display}}</td></tr>
    <tr valign="top"><th>Plan:</th><td>{{object.get_plan_display}}</td></tr>
	<tr valign="top"><th NOWRAP>Desired Resolution:</th><td>{{object.resolution}}</td></tr>
	<tr valign="top"><th>Delta Angle:</th><td>{{object.delta_angle}}</td></tr>
	<tr valign="top"><th>Multiplicity:</th><td>{{object.multiplicity}}</td></tr>
	<tr valign="top"><th>Angle Range:</th><td>{{object.total_angle}}</td></tr>
	<tr valign="top"><th>I/Sigma:</th><td>{{object.i_sigma}}</td></tr>
	<tr valign="top"><th>Desired R-factor:</th><td>{{object.r_meas}}</td></tr>
	{% if object.energy %}<tr valign="top"><th>Energy:</th><td>{{object.energy}}</td></tr>{% endif %}
	{% if object.absorption_edge %}<tr valign="top"><th>Absorption Edge:</th><td>{{object.absorption_edge}}</td></tr>{% endif %}
	<tr valign="top"><th>Completed:</th><td>{% if object.get_status_display == 'Complete' %}Yes{% else %} No {% endif %}</td></tr>
	<tr valign="top"><th>Shipment:</th><td>
        {% for shipment in object.get_shipments %}<a href="{% url lims-shipment-detail shipment.pk %}">{{shipment.name}} </a>{% endfor %}
    </td></tr>
    {% if user.is_superuser %}
    	<tr valign="top"><th>Project:</th><td>{{object.project.name}}</td></tr>
    {% endif %}
</table>

{% if object.comments or object.staff_comments or object.experiment_errors %}
    <div class="entrycomment">
    <span class="left-pointer"></span>
    <h3>Comments</h3>
    <div class="user">{{ object.comments|default:""|restructuredtext}}</div>
    <div class="staff">{{ object.staff_comments|default:""|restructuredtext}}</div>
    	{% if object.experiment_errors %}
    	<div class="errors">
    	{% for error in object.experiment_errors %}
        {% if forloop.counter != 1 %}; 
        {% endif %}
        {{error|capfirst}}
        {% endfor %}
        </div>
    	{% endif  %}
    </div>
{% endif %}
<div class="clear"></div>

<!-- object.crystal_set.all contains all the crystals -->
{% load crystal_table %}

{% if object.get_status_display == 'Draft' %}
    {% crystal_priority_table object.crystal_set.all request.user.is_superuser object.pk %}
{% else %}
    {% crystal_table object.crystal_set.all request.user.is_superuser object.pk %}
{% endif %}

<div style="clear: both;"></div>

{% endblock %}

{% block sidebar %}
	{% if not user.is_superuser %}
        {% if object.is_editable %}
		    <div id="crystals" class="widget droppable-remove parent-stop" data="{% url lims-crystal-basic-list %}?orphan_field=experiment">
		       <div class="widget-title">
		       <span>Crystals</span><a href="{% url lims-crystal-new %}" class="modal-form add-action" title="Add New Crystal"><img src="/img/small-add-icon.png" /></a>
		       </div>
		        <ul>
                    <p class="list-empty">( Not loaded )</p>
		        </ul>
		    </div>
        {% else %}
            {% include "lims/entries/comments_form.html" %}
        {% endif %}
    {% else %}
        {% include "staff/entries/comments_form.html" %}
    {% endif %}
    {% include "lims/individual_history.html" %}
{% endblock %}


