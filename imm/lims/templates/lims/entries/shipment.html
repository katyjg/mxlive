{% extends "base.html" %}
{% load humanize %}

{% block headline %}
<h2><span class="identity">{{object.identity}}</span> {{object.name}}</h2>
{% endblock %}

{% block object-tools %}
<div class="object-tools">
    {% include "lims/tools.html" %}
    <ul class="toolbar">
        <li class="back-tool" >
            <a href="{% url lims-shipment-list %}">Full List</a>
        </li>
    </ul>
</div>
{% endblock %}

{% block content %}

{% with object as shipment %}   
    <div class="shipment droppable droppable-replace" accept="dewar" title="Drag and drop onto this image"></div>
    <table class="entrysummary" cellpadding="0" cellspacing="0" border="0">
        <tr valign="top"><th>Status:</th><td>{{ shipment.get_status_display }}</td></tr>
        {% ifequal shipment.status shipment.STATES.DRAFT %}
            <tr valign="top"><th>Shippable:</th><td>{{shipment.shipping_errors|yesno:"No,Yes"}}</td></tr>
        {% endifequal %}
        {% if shipment.date_shipped %}
        	<tr valign="top"><th>Carrier:</th><td>{{ shipment.carrier }}</td></tr>
        	<tr valign="top"><th>Shipped:</th><td>{{shipment.date_shipped|naturalday}} at {{shipment.date_shipped|date:"H:i T"}}</td></tr>
        	<tr valign="top"><th NOWRAP>Tracking Code:</th><td>{{ shipment.tracking_code }}</td></tr>
        {% endif %}
        {% if shipment.date_received %}
        	<tr valign="top"><th>Received:</th><td>{{shipment.date_received|naturalday}} at {{shipment.date_received|date:"H:i T"}}</td></tr>
        {% endif %}
        {% if shipment.date_returned %}
        	<tr valign="top"><th>Returned:</th><td>{{shipment.date_returned|naturalday}}</td></tr>
        	<tr valign="top"><th NOWRAP>Return Code:</th><td>{{ shipment.return_code }}</td></tr>
        {% endif %}
        <tr valign="top"><th>Processed:</th><td>{% if shipment.is_processed %}Yes{% else %} No {% endif %}</td></tr>
    </table>

{% if shipment.comments or shipment.shipping_errors %}
    <div class="entrycomment">
    <span class="left-pointer"></span>
    <h3>Comments</h3>
    <p>{{ shipment.comments|default:""}}</p>
    	{% if shipment.shipping_errors %}
    	<ul>
    	{% for error in shipment.shipping_errors %}
        <li style="color: red">{{error}}</li>
        {% endfor %}
        </ul>
    	{% endif  %}
    </div>
{% endif  %}

    <div class="clear"></div>
    
    <div class="object-list">
    <h3>Dewars</h3>
    <!--img src="/img/dewar.png" style="float:right;clear: right; margin: 0.5em; padding-right: 2em;"/-->

    {% with shipment.dewar_set as dewars %}
        {% if dewars.count %}
            {% load dewar_table %}
            {% for dewar in dewars.all %}
                {% dewar_table dewar request.user.is_superuser "shipment" %}
            {% endfor %}
        {% else %}
            <table width="100%">
            <tr><td colspan="20" align="center" class="list-empty">(No dewars assigned to this shipment)</td></tr>
            </table>
        {% endif %}
    {% endwith %}
    </div>

{% endwith %}

{% endblock %}

{% block sidebar %}
    {% if not request.user.is_superuser %} {# We don't want these to show on the staff side #}
        <div id="dewars" class="widget droppable-remove parent-stop" data="{% url lims-dewar-basic-list %}">
	       <div class="widget-title">
	       <span>Dewars</span><a href="{% url lims-dewar-new %}" class="modal-form add-action" title="Add New Dewar"><img src="/img/small-add-icon.png" /></a>
	       </div>
            <ul>
                <li><a href="#">Content Not Loaded.</a></li>
            </ul>
        </div>

        <div id="containers" class="widget droppable-remove parent-stop" data="{% url lims-container-basic-list %}">
	       <div class="widget-title">
	       <span>Container</span><a href="{% url lims-container-new %}" class="modal-form add-action" title="Add New Container"><img src="/img/small-add-icon.png" /></a>
	       </div>
            <ul>
                <li><a href="#">Content Not Loaded.</a></li>
            </ul>
        </div>
    {% endif %}
{% endblock %}
