{% extends "base.html" %}
{% load zip %}
{% load split_char %}
{% load list_dir %}
{% load flot_extras %}
{% block extrastyle %}
    <script type="text/javascript" src="/js/imm-reports.flot.js"></script>
{% endblock %}
{% block headline %}
<h2 class="process">{% if object.details.anomalous %}Anomalous {% endif %}Data Processing Report - &ldquo;{{object.name}}&rdquo;</h2>
{% endblock %}
{% block object-tools %}
<div class="object-tools">
    {% include "lims/tools.html" %}
    <ul class="toolbar">
        <li class="print-tool" >
            <a href="javascript:window.print();">Print</a>
        </li>
    </ul>
</div>
{% endblock %}

{% block content-override %}
<!-- maincol -->
<div id="content" class="col-12">

<div id="result-page">   
    <h3>Summary</h3>
    <div id="result-summary">
        <table id="result-table">
            <colgroup>
                <col class="result-labels"/>
            </colgroup>
            <tbody>
                <tr><td>Score<sup class="footnote">[1]</sup></td><td>{{object.score|floatformat:"-2"}}</td></tr>
                <tr><td>Wavelength (A)</td><td>{{object.wavelength}}</td></tr>
                <tr><td>Space Group<sup class="footnote">[2]</sup></td><td>{{object.space_group.name}} </td></tr>
                <tr><td>Unit Cell (A)</td><td>{{object.cell_a|floatformat:"-2"}} {{object.cell_b|floatformat:"-2"}} {{object.cell_c|floatformat:"-2"}}<br/>
                {{object.cell_alpha|floatformat:"-1"}} {{object.cell_beta|floatformat:"-1"}} {{object.cell_gamma|floatformat:"-1"}}</td></tr>
                <tr><td>Resolution (A)<sup class="footnote">[3]</sup></td><td>{{object.resolution|floatformat:"-2"}}</td></tr>
                <tr><td>All Reflections</td><td>{{object.reflections}}</td></tr>
                <tr><td>Unique Reflections</td><td>{{object.unique}}</td></tr>
                <tr><td>Multiplicity</td><td>{{object.multiplicity|floatformat:"-1"}}</td></tr>
                <tr><td>Completeness</td><td>{{object.completeness|floatformat:"-2"}} %</td></tr>
                <tr><td>Mosaicity</td><td>{{object.mosaicity}}</td></tr>
                <tr><td>I/Sigma(I)</td><td>{{object.i_sigma}}</td></tr>
                <tr><td>R-meas<sup class="footnote">[4]</sup></td><td>{{object.r_meas}}</td></tr>
                {% if object.cc_half %}
                <tr><td>CC(&frac12;)<sup class="footnote">[5]</sup></td><td>{{object.cc_half}}</td></tr>
                {% else %}
                <tr><td>R-mrgd-F<sup class="footnote">[5]</sup></td><td>{{object.r_mrgd}}</td></tr>
                {% endif %}
                <tr><td>Spot deviation</td><td>{{object.sigma_spot}}</td></tr>
                <tr><td>Spindle deviation</td><td>{{object.sigma_angle}}</td></tr>
                {% ifnotequal object.ice_rings -1 %}
                    <tr><td>Ice Rings</td><td>{{object.ice_rings}}</td></tr>
                {% endifnotequal %}           
            </tbody>
        </table>
    </div>

    <div id="summary-notes">
        <table id="result-table">
            <colgroup>
                <col class="result-labels"/>
            </colgroup>
            <tbody>
                <tr><th colspan=2>Related Entries</th></tr>              
                <tr><td>Crystal</td><td>{% if object.crystal %}<a href={% url lims-crystal-detail object.crystal.id %}>{{object.crystal}}</a>{% else %} &mdash; {% endif %}</td></tr>   
                <tr><td>Experiment</td><td>{% if object.experiment %}<a href={% url lims-experiment-detail object.experiment.id %}>{{object.experiment.name}}</a>{% else %} &mdash; {% endif %}</td></tr>     
                <tr><td>Dataset</td><td>{% if object.data %}<a class="modal" href={% url lims-data-detail object.data.id %}>{{object.data}}</a>{% else %} &mdash; {% endif %}</td></tr>                  
            </tbody>
        </table>
        <div class="clear spacer"></div>
        <table id="result-table">
            <colgroup>
                <col class="result-labels"/>
            </colgroup>
            <tbody>
                <tr><th colspan=2>Downloads</th></tr>              
                <tr><td>Output Files</td>
                    <td>{% for file in object.details.output_files %}{% with file|split_char:"/" as filename %}<a href="/download/files/{{ object.url }}/{{ filename }}" title="Download {{ filename }}">{{ filename }}</a>{% if forloop.last %}{% else %}, {% endif %}{% endwith %}{% endfor %}</td></tr>   
                <tr><td>Input Files</td>
                    <td>
                    {% with "XDS.INP" as file %}<a href="/download/files/{{ object.url }}/{{ file }}" title="Download {{ file }}">{{ file }}</a>{% endwith %}, 
                    {% with "XDSCONV.INP" as file %}<a href="/download/files/{{ object.url }}/{{ file }}" title="Download {{ file }}">{{ file }}</a>{% endwith %}, 
                    {% with "XSCALE.INP" as file %}<a href="/download/files/{{ object.url }}/{{ file }}" title="Download {{ file }}">{{ file }}</a>{% endwith %}
                    </td></tr>   
                <tr><td style="width: 80px; vertical-align: top;">
                        <a class="more" href="javascript:displayFiles(true)">More...</a>
                        <a class="less" href="javascript:displayFiles(false)" style="display: none;">Hide</a>
                    </td><td><p id="all-files"</p></td></tr>  
            </tbody>
        </table>
        <div class="clear spacer"></div>
        <div class="tablenotes">
        <h3>Notes</h3>
            <dl class="note-list">
            <dt>[1] -<dt>
            <dd>
                Data Quality Score for comparing similar data sets. Typically, values >
                0.8 are excellent, > 0.6 are good, > 0.5 are acceptable, > 0.4
                marginal, and &lt; 0.4 are Barely usable
            </dd>
            <dt>[2] -<dt>
            <dd>
                This space group was automatically assigned using POINTLESS (see P.R.Evans,
                Acta Cryst. D62, 72-82, 2005). This procedure is unreliable for incomplete datasets
                such as those used for screening. Please Inspect the detailed results below.
            </dd>
            <dt>[3] -<dt>
            <dd>
                Resolution selected based on a cut-off of I/sigma(I) > 1.0. Statistics presented
                reflect this resolution.
            </dd>
            <dt>[4] -<dt>
            <dd>Redundancy independent R-factor. (see Diederichs & Karplus, 1997, Nature Struct. Biol. 4, 269-275.)</dd>
            <dt>[5] -<dt>
            {% if object.cc_half %}
            <dd>Percentage correlation between intensities from random half-datasets. (see Karplus & Diederichs (2012), Science. 336 (6084): 1030-1033)</dd>
            {% else %}
            <dd>Quality of amplitudes. (see Diederichs & Karplus, 1997, Nature Struct. Biol. 4, 269-275.)</dd>
            {% endif %}
        </dl>
        </div>
    </div>

    <div class="clear spacer"></div>

    <h3>Compatible bravais lattice types</h3>
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">No.</th>
                <th scope="col">Lattice type</th>
                <th scope="col">Cell Parameters</th>
                <th scope="col">Quality</th>
                <th scope="col">Cell Volume</th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.compatible_lattices as lattices %}
        {% zip lattices.id  lattices.type  lattices.unit_cell lattices.quality lattices.volume as tbl %}
        {% for rows in tbl %}
            <tr>
                <td>{{rows.0}}</td>
                <td>{{rows.1}}</td>
                <td>{{rows.2}}</td>
                <td>{{rows.3}}</td>
                <td>{{rows.4|floatformat:"-1"}}</td>
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
    </table>

    <h3>Automatic Space-Group Selection</h3>
    
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">Selected</th>
                <th scope="col">Candidates</th>
                <th scope="col">Space Group No.</th>
                <th scope="col">Probability</th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.spacegroup_selection as spacegroups %}
        {% zip spacegroups.name  spacegroups.space_group  spacegroups.probability as tbl %}
        {% for rows in tbl %}
            <tr>
            <td>
            {% ifequal forloop.counter 1 %}
            *
            {% endifequal %}
            </td>
                <td>{{rows.0}}</td>
                <td>{{rows.1}}</td>
                <td>{{rows.2|floatformat:"-1"}}</td>
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
        <tfoot>
        <tr><td colspan=4></td></tr>
        </tfoot>
    </table>
    <div class="tablenotes">
        <h3>Notes</h3>
        <p>The above table contains results from POINTLESS (see Evans, Acta Cryst. D62, 72-82, 2005).</p>
        <p>Indistinguishable space groups will have similar probabilities. If two or more of the top candidates have the same probability, the one with the fewest symmetry assumptions is chosen. This usually corresponds to the point group,  trying out higher symmetry space groups within the top tier does not require re-indexing the data as they are already in the same setting.</p>
        <p>For more detailed results, please inspect the output file 'pointless.log'.</p>
    </div><div class="clear spacer pagebreak"></div>
    
    <h3>Standard errors of reflection intensities by resolution</h3>
    <div id="stderr-chi2" class="report-flot" style="height: 225px;"></div>
    <div id="stderr-rfac" class="report-flot" style="height: 225px;"></div>
    <div class="tablenotes">
        <h3>Notes</h3>
        <dl class="note-list">
        <dt>I/Sigma    - </dt><dd>Mean intensity/Sigma of a reflection in shell</dd>
        <dt>&chi;&sup2;  - </dt><dd>Goodness of fit between sample variances of symmetry-related intensities and their errors (&chi;&sup2; = 1 for perfect agreement).</dd>
        <dt>R-observed - </dt><dd>&Sigma;|I(h,i)-I(h)| / &Sigma;[I(h,i)]</dd>
        <dt>R-expected - </dt><dd>Expected R-FACTOR derived from Sigma(I)</dd>
        </dl>
    </div>
    <div class="clear spacer pagebreak"></div>
    
    <h3>Statistics of final reflections by shell</h3>
    <div id="shell-comp" class="report-flot" style="height: 225px;"></div>
    <div id="shell-isig" class="report-flot" style="height: 225px;"></div>
    {% if object.cc_half %}
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">Shell</th>
                <th scope="col">Completeness</th>
                <th scope="col">R<sub>meas</sub></th>
                <th scope="col">CC<sub>&frac12;</sub></th>
                <th scope="col">I/sigma(I)<sup class="footnote">[1]</sup></th>
                <th scope="col">Sig<sub>ano</sub><sup class="footnote">[2]</sup></th>
                <th scope="col">CC<sub>ano</sub><sup class="footnote">[3]</sup></th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.shell_statistics as stats %}
        {% zip stats.shell  stats.completeness  stats.r_meas stats.cc_half stats.i_sigma stats.sig_ano stats.cor_ano as tbl %}
        {% for rows in tbl %}
            <tr>
            {% for col in rows %}
                <td>{{col|floatformat:"2"}}</td>
            {% endfor %}
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
        <tfoot>
        <tr><td colspan=4></td></tr>
        </tfoot>
    </table>
    <div class="tablenotes">
        <h3>Notes</h3>
        <dl class="note-list">
            <dt>[1] -<dt>
            <dd>
                Mean of intensity/Sigma(I) of unique reflections
                (after merging symmetry-related observations). Where Sigma(I) is
                the standard deviation of reflection intensity I estimated from sample statistics.
            </dd>
            <dt>[2] -<dt>
            <dd>
                mean anomalous difference in units of its estimated standard
                deviation (|F(+)-F(-)|/Sigma). F(+), F(-) are structure factor estimates
                obtained from the merged intensity observations in each parity class.
            </dd>
            <dt>[3] -<dt>
            <dd>
                Percentage of correlation between random half-sets of anomalous intensity differences.
            </dd>
        </dl>
    </div>    
    {% else %}
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">Shell</th>
                <th scope="col">Completeness</th>
                <th scope="col">R<sub>meas</sub></th>
                <th scope="col">R<sub>mrgd-F</sub></th>
                <th scope="col">I/sigma(I)<sup class="footnote">[1]</sup></th>
                <th scope="col">Sig<sub>ano</sub><sup class="footnote">[2]</sup></th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.shell_statistics as stats %}
        {% zip stats.shell  stats.completeness  stats.r_meas stats.r_mrgdf stats.i_sigma stats.sig_ano as tbl %}
        {% for rows in tbl %}
            <tr>
            {% for col in rows %}
                <td>{{col|floatformat:"2"}}</td>
            {% endfor %}
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
        <tfoot>
        <tr><td colspan=4></td></tr>
        </tfoot>
    </table>
    <div class="tablenotes">
        <h3>Notes</h3>
        <dl class="note-list">
            <dt>[1] -<dt>
            <dd>
                Mean of intensity/Sigma(I) of unique reflections
                (after merging symmetry-related observations). Where Sigma(I) is
                the standard deviation of reflection intensity I estimated from sample statistics.
            </dd>
            <dt>[2] -<dt>
            <dd>
                mean anomalous difference in units of its estimated standard
                deviation (|F(+)-F(-)|/Sigma). F(+), F(-) are structure factor estimates
                obtained from the merged intensity observations in each parity class.
            </dd>
        </dl>
    </div>
    {% endif %}

    <div class="clear spacer"></div>
    <h3>Statistics of final reflections by frame number and frame number difference</h3>
    <div id="frame-1" class="report-flot" style="height: 175px;"></div>
    <div id="frame-2" class="report-flot" style="height: 175px;"></div>
    <div id="frame-3" class="report-flot" style="height: 175px;"></div>
    <div id="diff" class="report-flot" style="height: 300px;"></div>
    <div class="tablenotes">
    <h3>Notes</h3>
        <p>The above plot was calculated by XDSSTAT. See See Diederichs K. (2006) Acta Cryst D62, 96-101.</p>
        <dl class="note-list">
        <dt>Divergence - </dt><dd>Estimated Standard Deviation of Beam divergence</dd>
        <dt>R<sub>d</sub> - </dt><dd>R-factors as a function of frame difference. An increase in R-d with frame difference is suggestive of radiation damage.</dd>
        </dl>
    </div>


    <h3>Wilson Plot</h3>
    <div id="wilson" class="report-flot" style="height: 400px;"></div>
    <div class="tablenotes">
        <h3>Notes</h3>
        <p>The above clipper-style wilson plot was calculated by CTRUNCATE which is part of the CCP4 Package.</p>
        <p>See S. French and K. Wilson, Acta Cryst. A34, 517-525 (1978).</p>
    </div>
    <div class="clear spacer"></div>

    <h3>L Test for twinning</h3>
    <div id="twinning" class="report-flot" style="height: 400px;"></div>
    <div class="tablenotes">
        <h3>Notes</h3>
        <p>The above plot was calculated by CTRUNCATE which is part of the CCP4 Package.</p>
        <p>All data regardless of I/sigma(I) has been included in the L test. Anisotropy correction has been applied before calculating L.</p>
        <p>See J. E. Padilla and T. O. Yeates, Acta Cryst. D59, 1124-1130 (2003)</p>
    </div>

</div>
</div>
<!-- end maincol -->
{% endblock %}

{% block script %}
    <script type="text/javascript">
    
        function displayFiles(display) {
            var files = '';
            if(display) {
	            {% for file in object.url|get_ls:object.details.output_files %}
	                files = files + '<a href="/download/files/{{ object.url }}/{{ file }}" title="Download {{ file }}">{{file}}</a>';
	                {% if not forloop.last %}files = files + ', ';{% endif %}
	            {% endfor %}
	            var more = "none", less = "";
	        } else {
	            var more = "", less = "none";
	        }
	            jQuery(".more").css("display", more);
	            jQuery(".less").css("display", less);
	            jQuery("#all-files").css("display", less);
	            jQuery("#all-files").html(files);
        }
        jQuery(document).ready(function() {
            displayFiles(false);
            var colors = ["#FF0000","#0000FF","#007700","#B300B2","#00CCCC","#CCCC0C"];
            var shadow = 0, lineWidth=1, yaxes = [], crosshair = {};
            
            /**************** Plot Error Stats ********************************/
            var chi_sq = {{object.details.standard_errors.chi_sq|get_data}};
            var i_sigma = {{object.details.standard_errors.i_sigma|get_data}};
            var r_obs = {{object.details.standard_errors.r_obs|get_data}};
            var r_exp = {{object.details.standard_errors.r_exp|get_data}};
            var shell_labels = [];
            {% for r in object.details.standard_errors.shell %}{% if forloop.counter0|divisibleby:"8" %}
                shell_labels.push([{{forloop.counter0}},{{r|floatformat:2}}]);
            {% endif %}{% endfor %}

            yaxes = [{ axisLabel: 'Chi\u00B2', color: colors[0], position: "left", labelWidth: 20, reserveSpace: true },
                     { axisLabel: 'I/Sigma', color: colors[1], position: "right", labelWidth: 20, reserveSpace: true }];
            plot_data($("#stderr-chi2"), [
                { data: chi_sq, color: colors[0], yaxis: 1, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: i_sigma, color: colors[1], yaxis: 2, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], shell_labels, yaxes, '', [], false);

            yaxes = [{ axisLabel: 'R-factors (%)', position: "left", labelWidth: 20, reserveSpace: true },
                     { position: "right", labelWidth: 38, reserveSpace: true }];
            plot_data($("#stderr-rfac"), [
                { data: r_obs, color: colors[2], yaxis: 1, label: 'R-observed', shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: r_exp, color: colors[3], yaxis: 1, label: 'R-expected', shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], shell_labels, yaxes, '', [], false);
            
            /**************** Plot Shell Stats ********************************/
            var completeness = {{object.details.shell_statistics.completeness|get_data}};
            var r_meas = {{object.details.shell_statistics.r_meas|get_data}};
            var cc_half = {% if 'r_mrgdf' in object.details.shell_statistics.keys %}{{object.details.shell_statistics.r_mrgdf|get_data}}
                        {% else %}{{object.details.shell_statistics.cc_half|get_data}}{% endif %};
            var i_sigma = {{object.details.shell_statistics.i_sigma|get_data}};
            var sig_ano = {{object.details.shell_statistics.sig_ano|get_data}};
            var shell_labels = [];
            {% for r in object.details.shell_statistics.shell %}{% if forloop.counter0|divisibleby:"1" %}
                shell_labels.push([{{forloop.counter0}},{{r|floatformat:2}}]);
            {% endif %}{% endfor %}
            
            yaxes = [{ axisLabel: 'Completeness (%)', color: colors[0], position: "left", labelWidth: 20, reserveSpace: true, min: 0, max: 100 },
                     { axisLabel: 'R-factors (%)', position: "right", labelWidth: 20, reserveSpace: true, min: 0, max: 100 }];
            plot_data($("#shell-comp"), [
                { data: completeness, color: colors[0], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth }, yaxis: 1 },
                { data: r_meas, color: colors[1], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth }, yaxis: 2, label: 'R-meas' },
                { data: cc_half, color: colors[2], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth/2 }, yaxis: 2, label: {% if 'r_mrgdf' in object.details.shell_statistics.keys %}'R-mrgd-F'{% else %}'CC<sub>1/2</sub>'{% endif %} }
                ], shell_labels, yaxes, '', [], false);

            yaxes = [{ axisLabel: 'I/Sigma(I)', color: colors[3], position: "left", labelWidth: 20, reserveSpace: true, min: 0 },
                     { axisLabel: 'SigAno', color: colors[4], position: "right", labelWidth: 20, reserveSpace: true, min: 0 }];
            plot_data($("#shell-isig"), [
                { data: i_sigma, color: colors[3], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth }, yaxis: 1 },
                        { data: sig_ano, color: colors[4], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth }, yaxis: 2 }
                ], shell_labels, yaxes, 'Resolution Shell', [], false);

            /**************** Plot Frame Stats ********************************/
            var scale = {{object.details.frame_statistics.scale|get_data:object.details.frame_statistics.frame_no}};
            var mosaicity = {{object.details.frame_statistics.mosaicity|get_data:object.details.frame_statistics.frame_no}};
            var divergence = {{object.details.frame_statistics.divergence|get_data:object.details.frame_statistics.frame_no}};
            var i_sigma = {{object.details.frame_statistics.i_sigma|get_data:object.details.frame_statistics.frame_no}};
            var r_meas = {{object.details.frame_statistics.r_meas|get_data:object.details.frame_statistics.frame_no}};
            var unique = {{object.details.frame_statistics.unique|get_data:object.details.frame_statistics.frame_no}};

            yaxes = [{ axisLabel: 'Scale Factor', color: colors[0], tickColor: "#dddddd", position: "left", labelWidth: 20, reserveSpace: true },
                     { axisLabel: 'Mosaicity', color: colors[2], tickColor: "#dddddd", position: "right", labelWidth: 20, reserveSpace: true }];
            plot_data($("#frame-1"), [
                { data: scale, color: colors[0], yaxis: 1, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: mosaicity, color: colors[2], yaxis: 2, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], null, yaxes, '', [], false);

            yaxes = [{ axisLabel: 'Divergence', color: colors[3], tickColor: "#dddddd", position: "left", labelWidth: 20, reserveSpace: true },
                     { axisLabel: 'I/Sigma(I)', color: colors[1], tickColor: "#dddddd", position: "right", labelWidth: 20, reserveSpace: true }];
            plot_data($("#frame-2"), [
                { data: divergence, color: colors[3], yaxis: 1, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: i_sigma, color: colors[1], yaxis: 2, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], null, yaxes, '', [], false);

            yaxes = [{ axisLabel: 'R-meas', color: colors[4], tickColor: "#dddddd", position: "left", labelWidth: 20, reserveSpace: true },
                     { axisLabel: 'Unique Reflections', color: colors[5], tickColor: "#dddddd", position: "right", labelWidth: 20, reserveSpace: true }];
            plot_data($("#frame-3"), [
                { data: r_meas, color: colors[4], yaxis: 1, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: unique, color: colors[5], yaxis: 2, shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], null, yaxes, 'Frame Number', [], false);     

            /**************** Plot Diff Stats *********************************/
            var all = {{object.details.diff_statistics.rd|get_data:object.details.diff_statistics.frame_diff}};
            var friedel = {{object.details.diff_statistics.rd_friedel|get_data:object.details.diff_statistics.frame_diff}};
            var non_friedel = {{object.details.diff_statistics.rd_non_friedel|get_data:object.details.diff_statistics.frame_diff}};
            yaxes = [{ axisLabel: 'R<sub>d</sub>', position: "left", labelWidth: 20, reserveSpace: true },{position: "right", labelWidth: 37, reserveSpace: true}];
            plot_data($("#diff"), [
                { data: all, color: colors[0], label: "All", shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: friedel, color: colors[3], label: "Friedel", shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: non_friedel, color: "#000000", label: "Non-Friedel", shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], null, yaxes, 'Frame Difference', [], false);                

            /**************** Plot Wilson***** ********************************/
            var wilson = [], shell_labels = [];
            var wilson = {{object.details.wilson_plot.log_i_sigma|get_data}};
            {% for dat in object.details.wilson_plot.inv_res_sq %}{% if forloop.counter0|divisibleby:"8" %}
                shell_labels.push([{{forloop.counter0}},{{dat|sq_root|floatformat:2}}]);
            {% endif %}{% endfor %}
            yaxes = [{ axisLabel: 'ln(I/Sigma(f)\u00B2)', position: "left", labelWidth: 20, reserveSpace: true }];
            plot_data($("#wilson"), [
                { data: wilson, color: colors[0], shadowSize: shadow, points: {show:true, radius: 1}, lines: {show: true, lineWidth: lineWidth } }
                ], shell_labels, yaxes, 'Resolution', [], false);
            var stats = '';
            {% with object.details.wilson_line as wstat %}
                stats = stats + 'Estimated B: {{wstat.0|floatformat:3}}<br>'
                stats = stats + 'sigma a: {{wstat.1|floatformat:-3}}<br>'
                stats = stats + 'sigma b: {{wstat.2|floatformat:3}}<br>';
            {% endwith %}
            {% if object.details.wilson_scale %}
                stats = stats + 'Scale factor: {{object.details.wilson_scale|floatformat:3}}';
            {% endif %} 
            $("#wilson").append('<div class="annotate" style="right:100px; top:50px;">'+stats+'</div>');


            /**************** Plot Twinning Analysis **************************/
            var observed = {{object.details.twinning_l_test.observed|get_data:object.details.twinning_l_test.abs_l}};
            var untwinned = {{object.details.twinning_l_test.untwinned|get_data:object.details.twinning_l_test.abs_l}};
            var twinned = {{object.details.twinning_l_test.twinned|get_data:object.details.twinning_l_test.abs_l}};
            yaxes = [{ axisLabel: 'P(L>=1)', position: "left", labelWidth: 20, reserveSpace: true, max: 1 }]
            plot_data($("#twinning"), [
                { data: observed, color: colors[0], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: untwinned, color: colors[1], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } },
                { data: twinned, color: colors[2], shadowSize: shadow, lines: {show: true, lineWidth: lineWidth } }
                ], null, yaxes, '|L|', [], false);
            var stats = '';
            {% with object.details.twinning_l_statistic as lstat %}
                stats = stats + '<a style="color: '+ colors[0]+';">Observed: {{lstat.0|floatformat:3}}</a><br>'
                stats = stats + '<a style="color: '+ colors[1]+';">Untwinned: {{lstat.1|floatformat:3}}</a><br>'
                stats = stats + '<a style="color: '+ colors[2]+';">Perfect Twin: {{lstat.2|floatformat:3}}</a>';
            {% endwith %}
            $("#twinning").append('<div class="annotate" style="right:100px; top:230px;">'+stats+'</div>');
        });
    </script>
{% endblock %}


            
           
             
