{% extends "base.html" %}
{% load zip %}
{% block headline %}
    {% ifequal object.kind object.RESULT_TYPES.SCREENING %}
        <h2 class="screen"> Crystal Screening Report - &ldquo;{{object.name}}&rdquo;</h2>
    {% else %}
        <h2 class="process"> Data Processing Report - &ldquo;{{object.name}}&rdquo;</h2>
    {% endifequal %}
{% endblock %}
{% block content-override %}
<!-- maincol -->
<div id="content" class="col-12">


<div id="view-images" class="hidden modal-content"></div>

<div id="result-page">
    {% comment %}
    <div id="result-links" class="floatright">
        <ul>
            <li>Crystal: &nbsp;<a href={% url lims-crystal-detail object.crystal.id %}>{{object.crystal}}</a></li>
            <li>Experiment: &nbsp;<a href={% url lims-experiment-detail object.experiment.id %}>{{object.experiment.name}}</a></li>
            <li>Dataset: &nbsp;<a href={% url lims-dataset-detail object.data.id %}>{{object.data}}</a></li>
            <li>Print: <a href="{% url lims-result-print object.id %}">Click to print</a></li>
    {% if object.is_resubmittable %}
            <li><a class="add-tool" href='/lims/experiment/result/{{object.get_results_link}}'>Resubmit</a></li>
    {% endif %}
        </ul>
    </div>

    <div class="clear"></div>
    {% endcomment %}
    
    <h3>Summary</h3>
    <div id="result-summary">
        <table id="result-table">
            <colgroup>
                <col class="result-labels"/>
            </colgroup>
            <tbody>
                <tr><td>Score<sup class="footnote">[1]</sup></td><td>{{object.score|floatformat:"-2"}}</td></tr>
                <tr><td>Wavelength (A)</td><td>{{object.data.wavelength}}</td></tr>
                <tr><td>Space Group<sup class="footnote">[2]</sup></td><td>{{object.space_group.name}} </td></tr>
                <tr><td>Unit Cell (A)</td><td>{{object.cell_a|floatformat:"-2"}} {{object.cell_b|floatformat:"-2"}} {{object.cell_c|floatformat:"-2"}}
                {{object.cell_alpha|floatformat:"-1"}} {{object.cell_beta|floatformat:"-1"}} {{object.cell_gamma|floatformat:"-1"}}</td></tr>
                <tr><td>Resolution (A)<sup class="footnote">[3]</sup></td><td>{{object.resolution|floatformat:"-2"}}</td></tr>
                <tr><td>All Reflections</td><td>{{object.reflections}}</td></tr>
                <tr><td>Unique Reflections</td><td>{{object.unique}}</td></tr>
                <tr><td>Multiplicity</td><td>{{object.multiplicity|floatformat:"-1"}}</td></tr>
                <tr><td>Completeness</td><td>{{object.completeness|floatformat:"-2"}} %</td></tr>
                <tr><td>Mosaicity</td><td>{{object.mosaicity}}</td></tr>
                <tr><td>I/Sigma(I)</td><td>{{object.i_sigma}}</td></tr>
                <tr><td>R-meas<sup class="footnote">[4]</sup></td><td>{{object.r_meas}}</td></tr>
                <tr><td>R-mrgd-F<sup class="footnote">[5]</sup></td><td>{{object.r_mrgd}}</td></tr>
                <tr><td>Spot deviation</td><td>{{object.sigma_spot}}</td></tr>
                <tr><td>Spindle deviation</td><td>{{object.sigma_angle}}</td></tr>
                {% ifnotequal object.ice_rings -1 %}
                    <tr><td>Ice Rings</td><td>{{object.ice_rings}}</td></tr>
                {% endifnotequal %}
            </tbody>
        </table>
    </div>

    <div class="tablenotes col-5">
        <h3>Notes</h3>
            <dl class="note-list">
            <dt>[1] -<dt>
            <dd>
                Data Quality Score for comparing similar data sets. Typically, values >
                0.8 are excellent, > 0.6 are good, > 0.5 are acceptable, > 0.4
                marginal, and &lt; 0.4 are Barely usable
            </dd>
            <dt>[2] -<dt>
            <dd>
                This space group was automatically assigned using POINTLESS (see P.R.Evans,
                Acta Cryst. D62, 72-82, 2005). This procedure is unreliable for incomplete datasets
                such as those used for screening. Please Inspect the detailed results below.
            </dd>
            <dt>[3] -<dt>
            <dd>
                Resolution selected based on a cut-off of I/sigma(I) > 1.0. Statistics presented
                reflect this resolution.
            </dd>
            <dt>[4] -<dt>
            <dd>Redundancy independent R-factor. (see Diederichs & Karplus, 1997, Nature Struct. Biol. 4, 269-275.)</dd>
            <dt>[5] -<dt>
            <dd>Quality of amplitudes. (see Diederichs & Karplus, 1997, Nature Struct. Biol. 4, 269-275.)</dd>
        </dl>
    </div>

    <div class="clear spacer"></div>

    <h3>Compatible bravais lattice types</h3>
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">No.</th>
                <th scope="col">Lattice type</th>
                <th scope="col">Cell Parameters</th>
                <th scope="col">Quality</th>
                <th scope="col">Cell Volume</th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.compatible_lattices as lattices %}
        {% zip lattices.id  lattices.type  lattices.unit_cell lattices.quality lattices.volume as tbl %}
        {% for rows in tbl %}
            <tr>
                <td>{{rows.0}}</td>
                <td>{{rows.1}}</td>
                <td>{{rows.2}}</td>
                <td>{{rows.3}}</td>
                <td>{{rows.4|floatformat:"-1"}}</td>
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
    </table>

    <h3>Automatic Space-Group Selection</h3>
    
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">Selected</th>
                <th scope="col">Candidates</th>
                <th scope="col">Space Group No.</th>
                <th scope="col">Probability</th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.spacegroup_selection as spacegroups %}
        {% zip spacegroups.name  spacegroups.space_group  spacegroups.probability as tbl %}
        {% for rows in tbl %}
            <tr>
            <td>
            {% ifequal forloop.counter 1 %}
            *
            {% endifequal %}
            </td>
                <td>{{rows.0}}</td>
                <td>{{rows.1}}</td>
                <td>{{rows.2|floatformat:"-1"}}</td>
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
        <tfoot>
        <tr><td colspan=4></td></tr>
        </tfoot>
    </table>
<div class="tablenotes">
    <h3>Notes</h3>
    <p>The above table contains results from POINTLESS (see Evans, Acta Cryst. D62, 72-82, 2005).</p>
    <p>Indistinguishable space groups will have similar probabilities. If two or more of the top candidates have the same probability, the one with the fewest symmetry assumptions is chosen. This usually corresponds to the point group,  trying out higher symmetry space groups within the top tier does not require re-indexing the data as they are already in the same setting.</p>
    <p>For more detailed results, please inspect the output file 'pointless.log'.</p>
    </div>
    <div class="clear spacer"></div>
    <div class="image">
    <h3>Reference Profiles as a function of detector region</h3>
    <img src="profiles.png" />
    </div>
    <div class="clear"></div>
    <div class="tablenotes">
    <h3>Notes</h3>
    <p>Profiles are determined at 9 region on the detector surface shown on the left-most column.</p>
    <p>Nice slices for the corresponding detector region are shown on the right of each region </p>
    </div>
    <div class="pagebreak"></div>
    <div class="image">
    <h3>Standard errors of reflection intensities by resolution</h3>
    <img src="stderr.png">
    </div>
    <div class="clear"></div>
    <div class="tablenotes">
    <h3>Notes</h3>
    <dl class="note-list">
    <dt>I/Sigma    - </dt><dd>Mean intensity/Sigma of a reflection in shell</dd>
    <dt>&chi;&sup2;  - </dt><dd>Goodness of fit between sample variances of symmetry-related intensities and their errors (&chi;&sup2; = 1 for perfect agreement).</dd>
    <dt>R-observed - </dt><dd>&Sigma;|I(h,i)-I(h)| / &Sigma;[I(h,i)]</dd>
    <dt>R-expected - </dt><dd>Expected R-FACTOR derived from Sigma(I)</dd>
    </dl>
    </div>
    <div class="pagebreak"></div>
    <h3>Statistics of final reflections by shell</h3>
    <div class="image">
    <image src={% if admin %}
    	{% url staff-plot-shells object.id %}
    	{% else %}
    	{% url lims-plot-shells object.id %} 
    	{% endif %}/>
    </div>
    <table class="rtable full">
        <thead>
            <tr>
                <th scope="col">Shell</th>
                <th scope="col">Completeness</th>
                <th scope="col">R<sub>meas</sub></th>
                <th scope="col">R<sub>mrgd-F</sub></th>
                <th scope="col">I/sigma(I)<sup class="footnote">[1]</sup></th>
                <th scope="col">Sig<sub>ano</sub><sup class="footnote">[2]</sup></th>
            </tr>
        </thead>
        <tbody>
        {% with object.details.shell_statistics as stats %}
        {% zip stats.shell  stats.completeness  stats.r_meas stats.r_mrgdf stats.i_sigma stats.sig_ano as tbl %}
        {% for rows in tbl %}
            <tr>
            {% for col in rows %}
                <td>{{col|floatformat:"2"}}</td>
            {% endfor %}
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
        <tfoot>
        <tr><td colspan=4></td></tr>
        </tfoot>
    </table>
    <div class="tablenotes">
        <h3>Notes</h3>
        <dl class="note-list">
            <dt>[1] -<dt>
            <dd>
                Mean of intensity/Sigma(I) of unique reflections
                (after merging symmetry-related observations). Where Sigma(I) is
                the standard deviation of reflection intensity I estimated from sample statistics.
            </dd>
            <dt>[2] -<dt>
            <dd>
                mean anomalous difference in units of its estimated standard
                deviation (|F(+)-F(-)|/Sigma). F(+), F(-) are structure factor estimates
                obtained from the merged intensity observations in each parity class.
            </dd>
        </dl>
    </div>

    <div class="clear spacer"></div>
<div class="image">
<h3>Wilson Plot</h3>
<img src="wilson.png">
</div>
<div class="clear">
</div>
<div class="tablenotes">
<h3>Notes</h3>
<p>The above clipper-style wilson plot was calculated by CTRUNCATE which is part of the CCP4 Package.</p>
<p>See S. French and K. Wilson, Acta Cryst. A34, 517-525 (1978).</p>
</div>
<div class="image">
<h3>L Test for twinning</h3>
<img src="twinning.png">
</div>
<div class="clear">
</div>
<div class="tablenotes">
<h3>Notes</h3>
<p>The above plot was calculated by CTRUNCATE which is part of the CCP4 Package.</p>
<p>All data regardless of I/sigma(I) has been included in the L test. Anisotropy correction has been applied before calculating L.</p>
<p>See J. E. Padilla and T. O. Yeates, Acta Cryst. D59, 1124-1130 (2003)</p>
</div>

</div>

</div>
<!-- end maincol -->
{% endblock %}
