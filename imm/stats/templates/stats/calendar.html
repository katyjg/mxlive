{% extends "base.html" %}

{% load stats_extras %}
{% load truncate_filters %}

{% block headline %}
<h2>Usage Statistics - {{month.1}} {{ month.2 }}</h2>
{% endblock %}

{% block object-tools %}
    <div class="object-tools">
        <ul class="toolbar">
            <li class="pie-tool"><a href="{% url stats-shifts month.2 %}" title="View {{month.2}} Statistics"> Stats</a>
            <li class="hist-tool"><a href="{% url stats-params month.2 %}" title="View {{month.2}} Parameter Statistics"> Params</a>
        </ul>
        <div class="clear"></div>
    </div>
{% endblock %}

{% block content %}

<div class="object-list">
	<div class="list-tools">
	    <h3 class="current">
	        <a class="prev" href='{% url stats-calendar-any month=month.3 %}' title="Previous Month">
	            <img src="/img/prev.png" alt="Previous Month"></a>
	        <a class="current" href='{% url stats-calendar-now %}'>
	            Back to Current Month</a>
	        <a class="next" href='{% url stats-calendar-any month=month.4 %}' title="Next Month">
	            <img src="/img/next.png" alt="Next Month"></a>
	    </h3>
	</div>

    <h3>{{month.1}} {{ month.2 }}</h3>

<table id="calendar">
    <thead>
        <tr>
		    <th></th>
		    <th class="weekday">Monday</th>
		    <th class="weekday">Tuesday</th>
		    <th class="weekday">Wednesday</th>
		    <th class="weekday">Thursday</th>
		    <th class="weekday">Friday</th>
		    <th class="weekday">Saturday</th>
		    <th class="weekday">Sunday</th>
        </tr>
    </thead>
    <tbody>
        {% for week in dates %}
            {% for name, bl in display.items %}
	            {% if forloop.first %}
	            <tr>
	                <td class="date header"></td>
	                {% for day in week %}
	                <td class="date
	                    {% ifequal month.0 day.1 %}current-month 
	                    {% ifequal current_date day.0 %}today{% endifequal %}{% endifequal %}">{{day.0}}</td>
	                {% endfor %}
	            </tr>
	            {% endif %}
	            <tr>
	                <td class="blabel header">
	                    <span>{{ name }}</span></td>
	                {% for day in week %}
	                <td class="stats
	                    {% ifequal month.0 day.1 %}current-month 
	                    {% ifequal current_date day.0 %}today{% endifequal %}{% endifequal %}
	                    {% if day.2 %}link-cell modal"
	                    href="{% url stats-data-list %}?beamline={{bl}}&created__year={{month.2}}&created__month={{month.0}}&created__day={{day.0}}&ot=asc&o=6" 
	                    {% else %}"{% endif %}>
		                {% with day.2|format_data:name as data %}
		                    {% for item in data %}
		                        <b>{{ item.0|truncate_chars:8 }}</b>({{ item.1 }})- 
		                            {% ifequal item.2 item.3 %}
		                                ({{ item.2 }})
		                            {%else %} 
		                                ({{item.2 }}-{{ item.3 }})
		                            {% endifequal %}
		                        <br>
		                    {% endfor %}
		                {% endwith %}</td>
	                {% endfor %}
	            </tr>
            {% endfor %}
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}

{% block sidebar %}
<div class="widget statistics" style="height:auto;" data="{% url stats-monthly month.2 month.0 %}">
    <div class="widget-title"><span>{{ month.1 }} {{ month.2 }} Usage</span></div>
    <ul><p class="list-empty"> ( Data not loaded ) </p></ul>
</div>
{% endblock %}
