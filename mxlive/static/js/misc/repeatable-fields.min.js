(function(a){"use strict";a.fn.repeatable_fields=function(b){var c=this;return c.after_add=function(b,d){var e=a(b).attr("data-rf-row-count");e++,a("*",d).each(function(){a.each(this.attributes,function(){this.value=this.value.replace(c.settings.row_count_placeholder,e-1)})}),a(b).attr("data-rf-row-count",e)},c.default_settings={wrapper:".wrapper",container:".container",row:".row",add:".add",remove:".remove",move:".move",move_up:".move-up",move_down:".move-down",move_steps:".move-steps",template:".template",is_sortable:!0,before_add:null,after_add:c.after_add,before_remove:null,after_remove:null,sortable_options:null,row_count_placeholder:"{{row-count-placeholder}}"},c.settings=a.extend({},c.default_settings,b),c.initialize=function(b){a(c.settings.wrapper,b).each(function(){var b=this,d=a(b).children(c.settings.container);a(d).children(c.settings.template).hide().find(":input").each(function(){a(this).prop("disabled",!0)});var e=a(d).children(c.settings.row).filter(function(){return!a(this).hasClass(c.settings.template.replace(".",""))}).length;if(a(d).attr("data-rf-row-count",e),a(b).on("click",c.settings.add,function(b){b.stopImmediatePropagation();var e=a(a(d).children(c.settings.template).clone().removeClass(c.settings.template.replace(".",""))[0].outerHTML);a(e).find(":input").each(function(){a(this).prop("disabled",!1)}),"function"==typeof c.settings.before_add&&c.settings.before_add(d);var f=a(e).show().appendTo(d);"function"==typeof c.settings.after_add&&c.settings.after_add(d,f,c.settings.after_add),c.initialize(f)}),a(b).on("click",c.settings.remove,function(b){b.stopImmediatePropagation();var e=a(this).parents(c.settings.row).first();"function"==typeof c.settings.before_remove&&c.settings.before_remove(d,e),e.remove(),"function"==typeof c.settings.after_remove&&c.settings.after_remove(d)}),!0===c.settings.is_sortable){if("undefined"!=typeof a.ui&&"undefined"!=typeof a.ui.sortable){var f=null===c.settings.sortable_options?{}:c.settings.sortable_options;f.handle=c.settings.move,a(b).find(c.settings.container).sortable(f)}a(b).find(c.settings.container).on("click",function(b){if(a(b.target).is(c.settings.move_up)||a(b.target).is(c.settings.move_down)){var d=1;if(1===a(b.target).siblings(c.settings.move_steps).length){var e=parseInt(a(b.target).siblings(c.settings.move_steps).val(),10);!1===isNaN(e)&&(0<e||-1===e)&&(d=e)}var f=a(b.target).closest(c.settings.row),g=0;if(!0===a(b.target).is(c.settings.move_up)){var h;for(g=0;-1===d||g<d;g++)if(void 0===h){if(1===f.prev().not(c.settings.template).length)h=f.prev();else break;}else if(1===h.prev().not(c.settings.template).length)h=h.prev();else break;void 0!==h&&h.before(f)}else if(!0===a(b.target).is(c.settings.move_down)){var j;for(g=0;-1===d||g<d;g++)if(void 0===j){if(1===f.next().length)j=f.next();else break;}else if(1===j.next().length)j=j.next();else break;void 0!==j&&j.after(f)}b.stopImmediatePropagation()}})}})},c.initialize(c),c}})(jQuery);