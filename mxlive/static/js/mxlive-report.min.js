function rounded(a){return a.toPrecision(1)}function choose(a){let b=Math.floor(Math.random()*a.length);return a[b]}function getPrecision(c,d){d=d||8;let e=c[0],a=c[c.length-1],b=((a-e)/d).toPrecision(1);return Math.max(0,Math.ceil(Math.log10(1/b))||2)}function inv_sqrt(b){let a=[];return $.each(b,function(b,c){var d=Math.pow;a[b]=d(c,-.5)}),a}function renderMarkdown(a){let b=new showdown.Converter;return b.makeHtml(a)}const figureTypes=["histogram","lineplot","barchart","scatterplot","pie","gauge"],scheme4=["#a0b552","#c56052","#9f6dbf","#8f9f9a"],scheme8=["#afc441","#cc5c3e","#64c192","#9aa156","#829aba","#9565c9","#c7588a","#a39384"],scheme14=["#cdc339","#67aec1","#c45a81","#6dc758","#a084b6","#667ccd","#c255b6","#6db586","#cd4f55","#805cd6","#cf622d","#a69e4c","#ae8e6b","#9b9795"];var contentTemplate=_.template("<div id=\"entry-<%= id %>\" <% let style = entry.style || \"\"; %> class=\"section-entry <%= style %>\" >   <% if ((entry.title) &! (entry.kind))  { %>       <h4><%= entry.title %></h4>   <% } %>   <% if (entry.description) { %>       <div class=\"description\"><%= renderMarkdown(entry.description) %></div>   <% } %>   <% if ((entry.kind === \"table\") && (entry.data)) { %>       <%= tableTemplate({id: id, entry: entry}) %>   <% } else if (figureTypes.includes(entry.kind)) { %>       <figure id=\"figure-<%= id %>\" data-type=\"<%= entry.kind %>\" data-chart='<%= JSON.stringify(entry) %>' >       </figure>   <% }%>   <% if (entry.notes) { %>       <div class=\"notes\"><%= renderMarkdown(entry.notes) %></div>   <% } %></div>"),sectionTemplate=_.template("<section id=\"section-<%= id %>\" <% let style = section.style || \"col-12\"; %>       class=\"<%= style %>\">       <%  if (section.title)  {%>       <h3 class=\"section-title col-12\"><%= section.title %></h3>       <% } %>       <%  if (section.description)  {%>       <div class=\"description\"><%= renderMarkdown(section.description) %></div>       <% } %>     <% _.each(section.content, function(entry, j){ %><%= contentTemplate({id: id+\"-\"+j, entry: entry}) %><% }); %></section>"),tableTemplate=_.template("<table id=\"table-<%= id %>\" class=\"table table-sm table-hover\"><% if (entry.title) { %>   <caption class=\"text-center\"><%= entry.title %></caption><% } %><% if (entry.header.includes(\"row\")) { %>   <thead><tr>       <% _.each(entry.data[0], function(cell, i){ %>       <th><%= cell %></th>       <% }); %>   </tr></thead><% } %><tbody><% _.each(entry.data, function(row, j){ %>   <% if ((!entry.header.includes(\"row\")) || (j>0)) { %>       <tr>       <% _.each(row, function(cell, i){ %>           <% if (entry.header.includes(\"column\") && (i==0)) { %>               <th><%= cell %></th>           <% } else { %>               <td><%= cell %></td>           <% } %>       <% }); %>       </tr>   <% } %><% }); %></tbody></table>");function drawXYChart(a,b,c,d="spline"){let e={},f=[],g={},h=d,i={interpolation:{}},j={x:{},y:{},y2:{}},k=[];if(b.data["x-limits"]&&(j.x.min=b.data["x-limits"][0]||null,j.x.max=b.data["x-limits"][0]||null),b.data["y1-limits"]&&(j.y.min=b.data["y1-limits"][0]||null,j.y.max=b.data["y1-limits"][0]||null),b.data["y2-limits"]&&(j.y2.min=b.data["y2-limits"][0]||null,j.y2.max=b.data["y2-limits"][0]||null),["cardinal","basis","step","step-before","step-after"].includes(b.data.interpolation)&&(h="spline",i.interpolation.type=b.data.interpolation),"time"===b.data["x-scale"])j.x={type:"timeseries",tick:{format:b.data["time-format"]}},$.each(b.data.x,function(a,b){0===a?k.push(b):k.push(Date.parse(b))});else{k=b.data.x;let a=k.slice(1,k.length),c=getPrecision(a),d=d3.interpolateDiscrete(a);j.x={type:"category",tick:{centered:!0,fit:!1,multiline:!1,culling:{max:8},format:function(b){let e=b/a.length;return d(e).toFixed(c)}}}}a.removeData("chart").removeAttr("data-chart"),f.push(k);let l=0;$.each(b.data.y1,function(a,b){f.push(b),g[b[0]]="y",e[b[0]]=c.scheme[l++],j.y.label=b[0]}),$.each(b.data.y2,function(a,b){f.push(b),g[b[0]]="y2",e[b[0]]=c.scheme[l++],j.y2={show:!0,label:b[0]}}),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:h,columns:f,colors:e,axes:g,x:b.data.x[0]},spline:i,point:{show:15>b.data.x.length},axis:j,grid:{y:{show:!0}},zoom:{enabled:!0,type:"drag"},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawBarChart(a,b,c){let d=[],e={};a.removeData("chart"),a.removeAttr("data-chart");let f=0;$.each(b.data.data[0],function(a){a!==b.data["x-label"]&&(d.push(a),e[a]=c.scheme[f++])}),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"bar",json:b.data.data,colors:e,keys:{x:b.data["x-label"],value:d},groups:b.data.stack||[]},grid:{y:{show:!0}},axis:{x:{type:"category",label:b.data["x-label"]}},legend:{hide:1===d.length},bar:{width:{ratio:.85}},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawHistogram(a,b,c){let d=b["y-scale"];a.removeData("chart"),a.removeAttr("data-chart"),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"bar",json:b.data,colors:{y:c.scheme[a.parent().index()]},keys:{x:"x",value:["y"]}},axis:{x:{tick:{fit:!1,count:10,format:a=>a.toFixed(1)}},y:{type:d}},legend:{hide:!0},grid:{y:{show:!0}},bar:{width:{ratio:.5}},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawPieChart(a,b,c){let d={},e=[],f={};a.removeData("chart"),a.removeAttr("data-chart"),$.each(b.data,function(a,b){d[b.label]=b.value,e.push(b.label),f[b.label]=c.scheme[a]}),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"pie",json:[d],colors:f,keys:{value:e}},onresiz1e:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawScatterChart(a,b,c){let d={},e=[],f={},g={},h={};a.removeData("chart").removeAttr("data-chart"),e.push(b.data.x);let j=0;$.each(b.data.y1,function(a,i){e.push(i),f[i[0]]="y",g[i[0]]=b.data.x[0],d[i[0]]=c.scheme[j++],h.y={label:i[0]}}),$.each(b.data.y2,function(a,i){e.push(i),f[i[0]]="y2",g[i[0]]=b.data.x[0],d[i[0]]=c.scheme[j++],h.y2={show:!0,label:i[0]}}),h.x={tick:{fit:!1}},c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"scatter",columns:e,colors:d,axes:f,xs:g},axis:h,grid:{y:{show:!0}},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}(function(a){a.fn.liveReport=function(b){let c=a(this),d=a.extend({data:{}},b);c.addClass("report-viewer"),a.each(d.data.details,function(a,b){c.append(sectionTemplate({id:a,section:b}))}),c.find("figure").each(function(){let b=a(this),c=b.data("chart"),d={width:b.width(),height:9*b.width()/16,scheme:c.data.colors||scheme14};switch(b.data("type")){case"barchart":drawBarChart(b,c,d);break;case"lineplot":drawXYChart(b,c,d,"line");break;case"histogram":drawHistogram(b,c,d);break;case"pie":drawPieChart(b,c,d);break;case"scatterplot":drawXYChart(b,c,d,"scatter");}c.title?b.after(`<figcaption class="text-center">${c.title}</figcaption>`):b.after(`<figcaption class="text-center"></figcaption>`)})}})(jQuery);