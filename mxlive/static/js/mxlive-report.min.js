function rounded(a){return a.toPrecision(1)}function choose(a){let b=Math.floor(Math.random()*a.length);return a[b]}function getPrecision(c,d){d=d||8;let e=c[0],a=c[c.length-1],b=((a-e)/d).toPrecision(1);return Math.max(0,Math.ceil(Math.log10(1/b))||2)}function inv_sqrt(b){let a=[];return $.each(b,function(b,c){var d=Math.pow;a[b]=d(c,-.5)}),a}function renderMarkdown(a){let b=new showdown.Converter;return b.makeHtml(a)}const figureTypes=["histogram","lineplot","barchart","scatterplot","pie","gauge","timeline","columnchart"],ColorSchemes={Live4:["#8f9f9a","#c56052","#9f6dbf","#a0b552"],Live8:["#073B4C","#06D6A0","#FFD166","#EF476F","#118AB2","#7F7EFF","#afc765","#78C5E7"],Live16:["#67aec1","#c45a81","#cdc339","#ae8e6b","#6dc758","#a084b6","#667ccd","#cd4f55","#805cd6","#cf622d","#a69e4c","#9b9795","#6db586","#c255b6","#073B4C","#FFD166"],Dark2:d3.schemeDark2,Set1:d3.schemeSet1,Set2:d3.schemeSet2,Set3:d3.scheme,Tableau10:d3.schemeTableau10};var contentTemplate=_.template("<div id=\"entry-<%= id %>\" <% let style = entry.style || \"\"; %> class=\"section-entry <%= style %>\" >   <% if ((entry.title) &! (entry.kind))  { %>       <h4><%= entry.title %></h4>   <% } %>   <% if (entry.description) { %>       <div class=\"description\"><%= renderMarkdown(entry.description) %></div>   <% } %>   <% if ((entry.kind === \"table\") && (entry.data)) { %>       <%= tableTemplate({id: id, entry: entry}) %>   <% } else if (figureTypes.includes(entry.kind)) { %>       <figure id=\"figure-<%= id %>\" data-type=\"<%= entry.kind %>\" data-chart='<%= JSON.stringify(entry) %>' >       </figure>   <% }%>   <% if (entry.notes) { %>       <div class=\"notes\"><%= renderMarkdown(entry.notes) %></div>   <% } %></div>"),sectionTemplate=_.template("<section id=\"section-<%= id %>\" <% let style = section.style || \"col-12\"; %>       class=\"<%= style %>\">       <%  if (section.title)  {%>       <h3 class=\"section-title col-12\"><%= section.title %></h3>       <% } %>       <%  if (section.description)  {%>       <div class=\"description\"><%= renderMarkdown(section.description) %></div>       <% } %>     <% _.each(section.content, function(entry, j){ %><%= contentTemplate({id: id+\"-\"+j, entry: entry}) %><% }); %></section>"),tableTemplate=_.template("<table id=\"table-<%= id %>\" class=\"table table-sm table-hover\"><% if (entry.title) { %>   <caption class=\"text-center\"><%= entry.title %></caption><% } %><% if (entry.header.includes(\"row\")) { %>   <thead><tr>       <% _.each(entry.data[0], function(cell, i){ %>       <th><%= cell %></th>       <% }); %>   </tr></thead><% } %><tbody><% _.each(entry.data, function(row, j){ %>   <% if ((!entry.header.includes(\"row\")) || (j>0)) { %>       <tr>       <% _.each(row, function(cell, i){ %>           <% if (entry.header.includes(\"column\") && (i==0)) { %>               <th><%= cell %></th>           <% } else { %>               <td><%= cell %></td>           <% } %>       <% }); %>       </tr>   <% } %><% }); %></tbody></table>");function drawXYChart(a,b,c,d="spline"){let e={},f=[],g={},h=d,i={interpolation:{}},j={x:{},y:{},y2:{}},k=[];if(b.data["x-limits"]&&(j.x.min=b.data["x-limits"][0]||null,j.x.max=b.data["x-limits"][0]||null),b.data["y1-limits"]&&(j.y.min=b.data["y1-limits"][0]||null,j.y.max=b.data["y1-limits"][0]||null),b.data["y2-limits"]&&(j.y2.min=b.data["y2-limits"][0]||null,j.y2.max=b.data["y2-limits"][0]||null),["cardinal","basis","step","step-before","step-after"].includes(b.data.interpolation)&&(h="spline",i.interpolation.type=b.data.interpolation),"time"===b.data["x-scale"])j.x={type:"timeseries",tick:{format:b.data["time-format"]}},$.each(b.data.x,function(a,b){0===a?k.push(b):k.push(Date.parse(b))});else{k=b.data.x;let a=k.slice(1,k.length),c=getPrecision(a),d=d3.interpolateDiscrete(a);j.x={type:"category",tick:{centered:!0,fit:!1,multiline:!1,culling:{max:8},format:function(b){let e=b/a.length;return d(e).toFixed(c)}}}}a.removeData("chart").removeAttr("data-chart"),f.push(k);let l=0;$.each(b.data.y1,function(a,b){f.push(b),g[b[0]]="y",e[b[0]]=c.scheme[l++],j.y.label=b[0]}),$.each(b.data.y2,function(a,b){f.push(b),g[b[0]]="y2",e[b[0]]=c.scheme[l++],j.y2={show:!0,label:b[0]}}),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:h,columns:f,colors:e,axes:g,x:b.data.x[0]},spline:i,point:{show:15>b.data.x.length},axis:j,grid:{y:{show:!0}},zoom:{enabled:!0,type:"drag"},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawBarChart(a,b,c){let d=[],e={};a.removeData("chart"),a.removeAttr("data-chart");let f=0;$.each(b.data.data[0],function(a){a!==b.data["x-label"]&&(d.push(a),e[a]=c.scheme[f++])}),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"bar",json:b.data.data,colors:e,keys:{x:b.data["x-label"],value:d},groups:b.data.stack||[]},grid:{y:{show:!0}},axis:{x:{type:"category",label:b.data["x-label"]},rotated:c.vertical||!1},legend:{hide:1===d.length},bar:{width:{ratio:.85}},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawHistogram(a,b,c){let d=b["y-scale"],e=b.data.data;a.removeData("chart"),a.removeAttr("data-chart"),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"bar",json:e,colors:{y:c.scheme[a.parent().index()]},keys:{x:"x",value:["y"]}},axis:{x:{tick:{fit:!1,count:10,format:a=>a.toFixed(1)}},y:{type:d}},legend:{hide:!0},grid:{y:{show:!0}},bar:{width:{ratio:.5}},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawPieChart(a,b,c){let d={},e=[],f={};a.removeData("chart"),a.removeAttr("data-chart"),$.each(b.data.data,function(a,b){d[b.label]=b.value,e.push(b.label),f[b.label]=c.scheme[a]}),c3.generate({bindto:`#${a.attr("id")}`,size:{width:c.width,height:c.height},data:{type:"pie",json:[d],colors:f,keys:{value:e}},onresize:function(){this.api.resize({width:a.width(),height:a.width()*c.height/c.width})}})}function drawScatterChart(a,b,c){drawXYChart(a,b,c,"scatter")}function callout(a,b){if(!b)return a.style("display","none");a.attr("data-label")&&(b=`${b} - ${a.attr("data-label")}`),a.attr("data-label"),a.style("display",null).style("pointer-events","none").style("font","10px sans-serif");const c=a.selectAll("path").data([null]).join("path").attr("fill","var(--warning)").attr("stroke","black"),d=a.selectAll("text").data([null]).join("text").call(a=>a.selectAll("tspan").data((b+"").split(/\n/)).join("tspan").attr("x",0).attr("y",(a,b)=>`${1.1*b}rem`).style("font-weight",(a,b)=>b?null:"bold").text(a=>a)),{x:e,y:f,width:g,height:i}=d.node().getBBox();d.attr("transform",`translate(${-g/2},${10-f})`),c.attr("d",`M${-g/2-10},5H-5l5,-5l5,5H${g/2+10}v${i+10}h-${g+20}z`)}function drawTimeline(a,b,c){let d=[],e={top:10,right:10,bottom:10,left:10},f=c.width-e.left-e.right,g=240;$.each(b.data,function(a,b){d.includes(b.type)||d.push(b.type)}),d.sort();let h=d3.scaleOrdinal().domain(d).range(c.scheme),i=d3.timeline().size([f,150]).extent([b.start,b.end]).bandStart(a=>a.start).bandEnd(a=>a.end).padding(2),j=i(b.data),k=d3.scaleLinear().domain([b.start,b.end]).range([0,f]),l=d3.axisBottom().scale(k).tickFormat(d3.timeFormat("%H:%M")),m=d3.select(`#${a.attr("id")}`).append("svg").attr("viewBox",`-${e.left} -${e.top} ${c.width} ${g}`).attr("class","w-100");m.selectAll("rect.event").data(j).enter().append("rect").attr("class","event").attr("x",function(a){return a.start}).attr("x",function(a){return a.start}).attr("y",function(a){return a.y}).attr("height",function(a){return a.dy}).attr("width",function(a){return a.end-a.start}).attr("data-label",a=>`${a.label}`).attr("data-type",a=>a.type).attr("shape-rendering","geometricPrecision").style("fill",a=>h(a.type)).style("stroke",a=>h(a.type)).attr("pointer-events","all").on("mouseover",function(){t.attr("data-label",$(this).data("label"))}).on("mouseout",function(){t.attr("data-label",null)}),m.append("g").call(l).attr("transform","translate(0, 160)");let n=0,o=80,p=m.append("g"),q=p.selectAll(".legend").data(d).enter().append("g").attr("class","legend").attr("data-type",function(a){return a}).attr("transform",function(a,b){if(0===b)return n=a.length+o,"translate(0,0)";else{let b=n;return n+=a.length+o,`translate(${b}, 0)`}}).on("mouseover",function(){let a=$(this).data("type");m.selectAll(`rect.event:not([data-type="${a}"])`).style("opacity",.1)}).on("mouseout",function(){m.selectAll("rect").style("opacity",1)});q.append("rect").attr("x",0).attr("y",0).attr("width",10).attr("height",10).style("fill",a=>h(a)),q.append("text").attr("x",20).attr("y",10).text(function(a){return a}).style("text-anchor","start").style("font-size","10");let r=f/2-n/2,s=g-e.bottom-30;p.attr("transform",`translate(${r}, ${s})`);const t=m.append("g"),u=m.append("g").attr("class","mouse-cursor").append("path").attr("class","mouse-line").style("stroke","var(--warning)").style("stroke-width","1px").style("opacity","0").attr("pointer-events","none");m.on("mouseleave",function(){d3.select(".mouse-line").style("opacity",0),t.call(callout,null)}).on("touchmove mousemove",function(){const a=d3.mouse(this),b=d3.timeFormat("%a %H:%M")(k.invert(a[0]));165>a[1]?(d3.select(".mouse-line").style("opacity",1).attr("d",function(){return`M ${a[0]}, 160, ${a[0]} 0`}),t.attr("transform",`translate(${a[0]}, 164)`).call(callout,b)):(d3.select(".mouse-line").style("opacity",0),t.call(callout,null))}),a.removeData("chart").removeAttr("data-chart"),window.onresize=function(){let b=f/a.width();m.selectAll("text").attr("transform",`scale(${b} ${b})`),m.selectAll("line").attr("stroke-width",`${b}px`)}}(function(a){a.fn.liveReport=function(b){let c=a(this),d=a.extend({data:{}},b);c.addClass("report-viewer"),a.each(d.data.details,function(a,b){c.append(sectionTemplate({id:a,section:b}))}),c.find("figure").each(function(){let b=a(this),c=b.data("chart"),d={width:b.width(),height:b.width()/(c.data["aspect-ratio"]||16/9)};switch(d.scheme=Array.isArray(c.data.colors)?c.data.colors:ColorSchemes[c.data.colors]||ColorSchemes.Live16,b.data("type")){case"barchart":drawBarChart(b,c,d);break;case"columnchart":d.vertical=!0,drawBarChart(b,c,d);break;case"lineplot":drawXYChart(b,c,d,"line");break;case"histogram":drawHistogram(b,c,d);break;case"pie":drawPieChart(b,c,d);break;case"scatterplot":drawScatterChart(b,c,d);break;case"timeline":drawTimeline(b,c,d);}c.title?b.after(`<figcaption class="text-center">${c.title}</figcaption>`):b.after(`<figcaption class="text-center"></figcaption>`)})}})(jQuery);