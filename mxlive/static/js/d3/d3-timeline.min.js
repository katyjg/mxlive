(function(){d3.timeline=function(){function a(a){var l=Math.max;function b(a){return margin.left+(a.starting_time-beginning)*D}function d(a){return margin.left+(a.starting_time-beginning)*D+5}function i(){if(n||v.attr("height"))n?v.attr("height",n):n=v.attr("height");else if(itemHeight)n=L.height+L.top-u.top,d3.select(a._groups[0].firstChild).attr("height",n);else throw"height of the timeline is not set"}function j(){if(!m&&!u.width)try{if(m=v.attr("width"),!m)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render"}catch(a){console.log(a)}else if(!(m&&u.width))try{m=v.attr("width")}catch(a){console.log(a)}}function k(b,c){a.append("svg:line").attr("x1",b).attr("y1",margin.top).attr("x2",b).attr("y2",n+margin.bottom+10).style("stroke",c.color).style("stroke-width",c.width),a.append("rect").attr("rx",4).attr("class","indicator-box"),a.append("text").attr("class","indicator").style("opacity",0)}var t=a.append("g"),u=a._groups[0][0].getBoundingClientRect(),v=d3.select(a._groups[0][0]),z={},A=1,B=0,C=0;j(),timeIsRelative&&t.each(function(a){a.forEach(function(a,b){a.times.forEach(function(a,c){0===b&&0===c?(originTime=a.starting_time,a.starting_time=0,a.ending_time-=originTime):(a.starting_time-=originTime,a.ending_time-=originTime)})})}),(stacked||0===ending||0===beginning)&&(t.each(function(a){a.forEach(function(a,b){stacked&&-1==Object.keys(z).indexOf(b)&&(z[b]=A,A++),a.times.forEach(function(a){0===beginning&&(a.starting_time<B||0===B&&!1===timeIsRelative)&&(B=a.starting_time),0===ending&&a.ending_time>C&&(C=a.ending_time)})})}),0===ending&&(ending=C),0===beginning&&(beginning=B));var D=1/(ending-beginning)*(m-margin.left-margin.right),E=d3.scaleTime().domain([beginning,ending]).range([margin.left,m-margin.right]),F=d3.axisBottom().scale(E).tickFormat(q.format).tickSize(q.tickSize);null==q.tickValues?F.ticks(q.numTicks||q.tickTime,q.tickInterval):F.tickValues(q.tickValues),t.each(function(h){chartData=h,h.forEach(function(h,j){function k(){return stacked?margin.top+(itemHeight+itemMargin)*z[j]:margin.top}var n=h.times,q="undefined"!=typeof h.label;if("undefined"!=typeof h.id&&console.warn("d3Timeline Warning: Ids per dataset is deprecated in favor of a 'class' key. Ids are now per data element."),p&&x(z,j,t,n,h),t.selectAll("svg").data(n).enter().append("rect").attr("x",b).attr("y",k).attr("width",function(a){return l((a.ending_time-a.starting_time)*D,1)}).attr("cy",function(a,b){return a.y||k(a,b)-itemHeight/2}).attr("cx",b).attr("r",itemHeight/2).attr("height",itemHeight).style("fill",function(a){var b;return a.color?a.color:colorPropertyName?(b=a[colorPropertyName],b?r(b):r(h[colorPropertyName])):r(j)}).on("mousemove",function(a){var b=d3.mouse(this);c(a,j,h,b[0],E.invert(b[0]))}).on("mouseover",function(a){a.y&&e(a,this,h)}).on("mouseout",function(a,b){f(a,b,h)}).on("click",function(a){g(a,j,h)}).attr("class",function(){return h.class?"timelineSeries_"+h.class:"timelineSeries_"+j}).attr("id",function(a,b){return h.id&&!a.id?"timelineItem_"+h.id:a.id?a.id:"timelineItem_"+j+"_"+b}),t.selectAll("svg").data(n).enter().append("text").attr("x",d).attr("y",function(){return stacked?margin.top+(itemHeight+itemMargin)*z[j]+.75*itemHeight:margin.top+.75*itemHeight}).text(function(a){return a.label}),o){var s=itemHeight+itemMargin/2+margin.top+(itemHeight+itemMargin)*z[j];a.append("svg:line").attr("class","row-separator").attr("x1",0+margin.left).attr("x2",m-margin.right).attr("y1",s).attr("y2",s).attr("stroke-width",1).attr("stroke",o)}q&&y(a,z,j,q,h),"undefined"!=typeof h.icon&&a.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(margin.top+(itemHeight+itemMargin)*z[j])+")").attr("xlink:href",h.icon).attr("width",margin.left).attr("height",itemHeight)})});var G=margin.top+(itemHeight+itemMargin)*A,H=margin.top,I=showAxisTop?H:G;if(showTimeAxis&&s(t,F,I),timeAxisTick&&w(t,F,A),m>u.width){var J=function(){var a=Math.min,b=a(0,l(u.width-m,d3.event.translate[0]));K.translate([b,0]),t.attr("transform","translate("+b+",0)"),h(b*D,E)},K=d3.behavior.zoom().x(E).on("zoom",J);a.attr("class","scrollable").call(K)}rotateTicks&&t.selectAll(".tick text").attr("transform",function(){return"rotate("+rotateTicks+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var L=t._groups[0][0].firstChild.getBoundingClientRect();if(i(),showBorderLine&&t.each(function(a){a.forEach(function(a){var b=a.times;b.forEach(function(a){k(E(a.starting_time),showBorderFormat),k(E(a.ending_time),showBorderFormat)})})}),showTodayLine){var M=E(new Date);k(M,showTodayFormat)}}var b=["circle","rect"],c=function(){},e=function(){},f=function(){},g=function(){},h=function(){},i=function(a){return a},j=function(){},k=function(){},l="bottom",m=null,n=null,o=null,p=null,q={format:d3.timeFormat("%I %p"),tickTime:d3.timeHour,tickInterval:1,tickSize:6,tickValues:null},r=d3.scaleOrdinal(d3.schemeCategory20);colorPropertyName=null,display="rect",beginning=0,labelMargin=0,ending=0,margin={left:30,right:30,top:30,bottom:30},stacked=!1,rotateTicks=!1,timeIsRelative=!1,fullLengthBackgrounds=!1,itemHeight=20,itemMargin=5,navMargin=60,showTimeAxis=!0,showAxisTop=!1,showTodayLine=!1,timeAxisTick=!1,timeAxisTickFormat={stroke:"stroke-dasharray",spacing:"4 10"},showTodayFormat={marginTop:25,marginBottom:0,width:1,color:r},showBorderLine=!1,showBorderFormat={marginTop:25,marginBottom:0,width:1,color:r},showAxisHeaderBackground=!1,showAxisNav=!1,showAxisCalendarYear=!1,axisBgColor="white",chartData={};var s=function(a,b,c){showAxisHeaderBackground&&v(a,0,0),showAxisNav&&u(a);a.append("g").attr("class","axis").attr("transform","translate(0,"+c+")").call(b)},t=function(a){var b=beginning.getFullYear();beginning.getFullYear()!=ending.getFullYear()&&(b=beginning.getFullYear()+"-"+ending.getFullYear()),a.append("text").attr("transform","translate(20, 0)").attr("x",0).attr("y",14).attr("class","calendarYear").text(b)},u=function(a){var b=margin.left-navMargin,c=(m-margin.left)/6,d=m-margin.right-c+navMargin,e=a.append("g").attr("class","axis").attr("transform","translate(0, 20)");showAxisCalendarYear&&t(e),e.append("text").attr("transform","translate("+b+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text("<").on("click",function(){return j(beginning,chartData)}),e.append("text").attr("transform","translate("+d+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text(">").on("click",function(){return k(ending,chartData)})},v=function(a,b,c){a.insert("rect").attr("class","row-green-bar").attr("x",b).attr("width",m).attr("y",c).attr("height",itemHeight).attr("fill",axisBgColor)},w=function(a,b,c){a.append("g").attr("class","axis").attr("transform","translate(0,"+(margin.top+(itemHeight+itemMargin)*c)+")").attr(timeAxisTickFormat.stroke,timeAxisTickFormat.spacing).call(b.tickFormat("").tickSize(-(margin.top+(itemHeight+itemMargin)*(c-1)+3),0,0))},x=function(a,b,c,d,e){var f=(itemHeight+itemMargin)*a[b]+margin.top;c.selectAll("svg").data(d).enter().insert("rect").attr("class","row-green-bar").attr("x",fullLengthBackgrounds?0:margin.left).attr("width",fullLengthBackgrounds?m:m-margin.right-margin.left).attr("y",f).attr("height",itemHeight).attr("fill",p instanceof Function?p(e,b):p)},y=function(a,b,c,d,e){var f=itemHeight+itemMargin,h=margin.top+f/2+f*(b[c]||1);a.append("text").attr("class","timeline-label").attr("transform","translate("+labelMargin+","+h+")").text(d?i(e.label):e.id).on("click",function(a){g(a,c,e)})};return a.margin=function(b){return arguments.length?(margin=b,a):margin},a.orient=function(b){return arguments.length?(l=b,a):l},a.itemHeight=function(b){return arguments.length?(itemHeight=b,a):itemHeight},a.itemMargin=function(b){return arguments.length?(itemMargin=b,a):itemMargin},a.navMargin=function(b){return arguments.length?(navMargin=b,a):navMargin},a.height=function(b){return arguments.length?(n=b,a):n},a.width=function(b){return arguments.length?(m=b,a):m},a.display=function(c){return arguments.length&&-1!=b.indexOf(c)?(display=c,a):display},a.labelFormat=function(b){return arguments.length?(i=b,a):i},a.tickFormat=function(b){return arguments.length?(q=b,a):q},a.hover=function(b){return arguments.length?(c=b,a):c},a.mouseover=function(b){return arguments.length?(e=b,a):e},a.mouseout=function(b){return arguments.length?(f=b,a):f},a.click=function(b){return arguments.length?(g=b,a):g},a.scroll=function(b){return arguments.length?(h=b,a):h},a.colors=function(b){return arguments.length?(r=b,a):r},a.beginning=function(c){return arguments.length?(beginning=c,a):beginning},a.ending=function(b){return arguments.length?(ending=b,a):ending},a.labelMargin=function(b){return arguments.length?(labelMargin=b,a):labelMargin},a.rotateTicks=function(b){return arguments.length?(rotateTicks=b,a):rotateTicks},a.stack=function(){return stacked=!stacked,a},a.relativeTime=function(){return timeIsRelative=!timeIsRelative,a},a.showBorderLine=function(){return showBorderLine=!showBorderLine,a},a.showBorderFormat=function(b){return arguments.length?(showBorderFormat=b,a):showBorderFormat},a.showToday=function(){return showTodayLine=!showTodayLine,a},a.showTodayFormat=function(b){return arguments.length?(showTodayFormat=b,a):showTodayFormat},a.colorProperty=function(b){return arguments.length?(colorPropertyName=b,a):colorPropertyName},a.rowSeparators=function(b){return arguments.length?(o=b,a):o},a.background=function(b){return arguments.length?(p=b,a):p},a.showTimeAxis=function(){return showTimeAxis=!showTimeAxis,a},a.showAxisTop=function(){return showAxisTop=!showAxisTop,a},a.showAxisCalendarYear=function(){return showAxisCalendarYear=!showAxisCalendarYear,a},a.showTimeAxisTick=function(){return timeAxisTick=!timeAxisTick,a},a.fullLengthBackgrounds=function(){return fullLengthBackgrounds=!fullLengthBackgrounds,a},a.showTimeAxisTickFormat=function(b){return arguments.length?(timeAxisTickFormat=b,a):timeAxisTickFormat},a.showAxisHeaderBackground=function(b){return showAxisHeaderBackground=!showAxisHeaderBackground,b&&(axisBgColor=b),a},a.navigate=function(b,c){return arguments.length?(j=b,k=c,showAxisNav=!showAxisNav,a):[j,k]},a}})();