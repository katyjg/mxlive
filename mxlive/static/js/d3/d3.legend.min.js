(function(){d3.legend=function(a){return a.each(function(){var a=d3.select(this),b={},c=d3.select(a.property("nearestViewportElement"));c.selectAll("[data-legend]").each(function(){var a=d3.select(this);b[a.attr("data-legend")]={pos:a.attr("data-legend-pos")||this.getBBox().y,color:null==a.attr("data-legend-color")?"none"==a.style("fill")?a.style("stroke"):a.style("fill"):a.attr("data-legend-color")}}),b=d3.entries(b).sort(function(c,a){return c.value.pos-a.value.pos}),a.selectAll("text").data(b).enter().append("text").attr("y",function(a,b){return b+"em"}).attr("x","1em").text(function(a){return a.key}),a.selectAll("circle").data(b).enter().append("circle").attr("cy",function(a,b){return b-.35+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(a){return a.value.color})}),a}})();