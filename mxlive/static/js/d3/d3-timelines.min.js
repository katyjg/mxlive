(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-axis"),require("d3-array"),require("d3-time-format"),require("d3-time"),require("d3-scale"),require("d3-selection"),require("d3-zoom")):"function"==typeof define&&define.amd?define(["exports","d3-axis","d3-array","d3-time-format","d3-time","d3-scale","d3-selection","d3-zoom"],b):b(a.d3=a.d3||{},a.d3,a.d3,a.d3,a.d3,a.d3,a.d3,a.d3)})(this,function(a,b,c,d,e,f,h,i){'use strict';a.timelines=function(){function a(a){function d(a){return H.left+(a.starting_time-E)*da}function e(a,b){var c=e.canvas||(e.canvas=document.createElement("canvas")),d=c.getContext("2d");d.font=b;var f=d.measureText(a);return f.width}function o(a,b,c,d){var f=0;if(a.ending_time&&(f=(a.ending_time-a.starting_time)/2*da),c&&d){var g=getComputedStyle(document.querySelector(d)),h=g.fontSize+" "+g.fontFamily,i=e(c,h),j=H.left+(a.starting_time-E)*da+f-i/2;return j}return H.left+(a.starting_time-E)*da+5}function q(){if(u||F.height)u?N.node().attr("height",u):u=F.height;else if(O)u=oa.height+oa.top-F.top,h.select(a).node().attr("height",u);else throw"height of the timeline is not set"}function r(){if(!t&&!F.width)try{if(t=N.node().attr("width"),!t)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render"}catch(a){console.log(a)}else if(!t&&F.width)try{t=F.width}catch(a){console.log(a)}}function z(a,b,c){c=c||"timeline-line",ea.append("svg:line").attr("x1",a).attr("y1",b.marginTop).attr("x2",a).attr("y2",u-b.marginBottom).attr("class",c).style("stroke",b.color).style("stroke-width",b.width)}var F=a.node().getBoundingClientRect(),N=h.select(a.node()),Q=a.append("g").attr("class","container"),g={},V=1,$=0,_=0;r(),L&&Q.each(function(a){var b=0;a.forEach(function(a,c){a.times.forEach(function(a,d){0===c&&0===d?(b=a.starting_time,a.starting_time=0,a.ending_time-=b):(a.starting_time-=b,a.ending_time-=b)})})}),(J||0===G||0===E)&&(Q.each(function(a){a.forEach(function(a,b){J&&-1==Object.keys(g).indexOf(b)&&(g[b]=V,V++),a.times.forEach(function(a){0===E&&(a.starting_time<$||0===$&&!1===L)&&($=a.starting_time),0===G&&a.ending_time>_&&(_=a.ending_time)})})}),0===G&&(G=_),0===E&&(E=$));var aa,ba,da=1/(G-E)*(t-H.left-H.right);"bottom"==s?ba=b.axisBottom():"top"==s&&(ba=b.axisTop()),M?(aa=f.scaleLinear().domain([E,G]).range([H.left,t-H.right]),ba.scale(aa).tickFormat(function(a){var b=Math.floor,c=b(a/86400),d=b((a-86400*c)/3600),e=b((a-86400*c-3600*d)/60),f=a-86400*c-3600*d-60*e,g="";return f&&(g=f+"s"),e&&(g=e+"m "+g),d&&(g=d+"h "+g),c&&(g=c+"d "+g),g}).tickValues(c.range(0,G,86400))):(aa=f.scaleTime().domain([E,G]).range([H.left,t-H.right]),ba.scale(aa).tickFormat(x.format).tickSize(x.tickSize)),null===x.tickValues?ba.tickArguments(x.numTicks||[x.tickTime,x.tickInterval]):ba.tickValues(x.tickValues);var ea=Q.append("g").attr("class","view");Q.each(function(b){A=b,b.forEach(function(b,c){function e(){return J?H.top+(O+P)*g[c]:H.top}function f(){return J?H.top+(O+P)*g[c]+.75*O:H.top+.75*O}var i=b.times;i.forEach(function(a){a.name=b.name});var n="undefined"!=typeof b.label;if("undefined"!=typeof b.id&&console.warn("d3Timeline Warning: Ids per dataset is deprecated in favor of a 'class' key. Ids are now per data element."),w&&ha(g,c,Q,i,b),ea.selectAll("svg").data(i).enter().append(function(a){return document.createElementNS(h.namespaces.svg,"display"in a?a.display:D)}).attr("x",d).attr("y",e).attr("width",function(a){return(a.ending_time-a.starting_time)*da}).attr("cy",function(a,b){return e(a,b)+O/2}).attr("cx",d).attr("r",O/2).attr("height",O).style("fill",function(a){var d;return a.color?a.color:C?(d=a[C],d?B(d):B(b[C])):B(c)}).on("mousemove",function(a,d){j(a,c,b,d)}).on("mouseover",function(a,c){k(a,c,b,c)}).on("mouseout",function(a,c){l(a,c,b,c)}).on("click",function(a){var d=h.mouse(this),e=h.select(this).node(),f="text#"+e.id+".textnumbers",g=h.select(f).node();m(a,c,b,g,e,aa.invert(d[0]))}).attr("class",function(){return b.class?"timelineSeries_"+b.class:"timelineSeries_"+c}).attr("id",function(a,d){return b.id&&!a.id?"timelineItem_"+b.id:a.id?a.id:"timelineItem_"+c+"_"+d}),ea.selectAll("svg").data(i).enter().append("text").attr("class","textlabels").attr("id",function(a){return a.id}).attr("x",function(a,b){return o(a,b,a.label,".textlabels")}).attr("y",f()-p).text(function(a){return a.label}).on("click",function(a){var d=h.mouse(this),e=this.id,f=h.select("text#"+e+".textnumbers").node(),g=h.select("rect#"+e).node();m(a,c,b,f,g,aa.invert(d[0]))}),ea.selectAll("svg").data(i).enter().filter(function(a){return void 0!==a.labelNumber}).append("text").attr("class","textnumbers").attr("id",function(a){return a.id}).attr("x",function(a,b){return o(a,b,a.labelNumber,".textnumbers")}).attr("y",f).text(function(a){return a.labelNumber}).on("click",function(a){var d=h.mouse(this),e=this.id,f=h.select(this).node(),g=h.select("rect#"+e).node();m(a,c,b,f,g,aa.invert(d[0]))}),v){var q=O+P/2+H.top+(O+P)*g[c];a.append("svg:line").attr("class","row-separator").attr("x1",0+H.left).attr("x2",t-H.right).attr("y1",q).attr("y2",q).attr("stroke-width",1).attr("stroke",v)}n&&ia(a,g,c,n,b),"undefined"!=typeof b.icon&&a.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(H.top+(O+P)*g[c])+")").attr("xlink:href",b.icon).attr("width",H.left).attr("height",O)})});var fa,ja=H.top+(O+P)*V,ka=H.top,la=S?ka:ja;if(R&&(fa=ca(Q,ba,la)),U&&ga(Q,ba,V),t>F.width)var ma=function(){Q.select(".view").attr("transform","translate("+h.event.transform.x+",0)scale("+h.event.transform.k+" 1)"),Q.selectAll(".timeline-xAxis").attr("transform",function(){return"translate("+h.event.transform.x+", "+la+")scale("+h.event.transform.k+" 1)"});var a=h.event.transform.rescaleX(aa);Q.selectAll(".timeline-xAxis").call(function(){ba.scale(a)});var b=-h.event.transform.x;n(b,aa)};var na=i.zoom().scaleExtent([0,I]).translateExtent([[0,0],[t,0]]).on("zoom",ma);a.classed("scrollable",!0).call(na),y||(Q.on("wheel",function(){h.event.preventDefault(),h.event.stopImmediatePropagation()}),Q.on("dblclick.zoom",function(){h.event.preventDefault(),h.event.stopImmediatePropagation()})),K&&Q.selectAll(".tick text").attr("transform",function(){return"rotate("+K+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var oa=Q.node().getBoundingClientRect();if(q(),X&&Q.each(function(a){a.forEach(function(a){var b=a.times;b.forEach(function(a){z(aa(a.starting_time),Y,Z),z(aa(a.ending_time),Y,Z)})})}),T){var pa=aa(new Date);z(pa,W)}}var g=["circle","rect"],j=function(){},k=function(){},l=function(){},m=function(){},n=function(){},o=function(a){return a},p=0,q=function(){},r=function(){},s="bottom",t=null,u=null,v=null,w=null,x={format:d.timeFormat("%I %p"),tickTime:e.timeHour,tickInterval:1,tickSize:6,tickValues:null},y=!0,z="white",A={},B=f.scaleOrdinal(f.schemeCategory20),C=null,D="rect",E=0,F=0,G=0,H={left:30,right:30,top:30,bottom:30},I=5,J=!1,K=!1,L=!1,M=!1,N=!1,O=20,P=5,Q=60,R=!0,S=!1,T=!1,U=!1,V={stroke:"stroke-dasharray",spacing:"4 10"},W={marginTop:25,marginBottom:0,width:1,color:B},X=!1,Y={marginTop:25,marginBottom:0,width:1,color:B},Z="timeline-border-line",$=!1,_=!1,aa=!1,ba="timeline-xAxis",ca=function(a,b,c){$&&fa(a,0,0),_&&ea(a);var d=a.append("g").attr("class",ba).attr("transform","translate(0,"+c+")").call(b);return d},da=function(a){var b=E.getFullYear();E.getFullYear()!=G.getFullYear()&&(b=E.getFullYear()+"-"+G.getFullYear()),a.append("text").attr("transform","translate(20, 0)").attr("x",0).attr("y",14).attr("class","calendarYear").text(b)},ea=function(a){var b=H.left-Q,c=(t-H.left)/6,d=t-H.right-c+Q,e=a.append("g").attr("class","axis").attr("transform","translate(0, 20)");aa&&da(e),e.append("text").attr("transform","translate("+b+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text("<").on("click",function(){return q(E,A)}),e.append("text").attr("transform","translate("+d+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text(">").on("click",function(){return r(G,A)})},fa=function(a,b,c){a.insert("rect").attr("class","row-green-bar").attr("x",b).attr("width",t).attr("y",c).attr("height",O).attr("fill",z)},ga=function(a,b,c){a.append("g").attr("class","axis").attr("transform","translate(0,"+(H.top+(O+P)*c)+")").attr(V.stroke,V.spacing).call(b.tickFormat("").tickSize(-(H.top+(O+P)*(c-1)+3),0,0))},ha=function(a,b,c,d,e){var f=(O+P)*a[b]+H.top;c.selectAll("svg").data(d).enter().insert("rect",":first-child").attr("class","row-green-bar").attr("x",N?0:H.left).attr("width",N?t:t-H.right-H.left).attr("y",f).attr("height",O).attr("fill",w instanceof Function?w(e,b):w)},ia=function(a,b,c,d,e){var f=O+P,g=H.top+f/2+f*(b[c]||1);a.append("text").attr("class","timeline-label").attr("transform","translate("+F+","+g+")").text(d?o(e.label):e.id).on("click",function(b){console.log("label click!");var d=h.mouse(this);a.append("rect").attr("id","clickpoint").attr("x",d[0]).attr("width",10).attr("height",O),m(b,c,e,d,xScale.invert(d[0]))})};return a.margin=function(b){return arguments.length?(H=b,a):H},a.orient=function(b){return arguments.length?(s=b,a):s},a.itemHeight=function(b){return arguments.length?(O=b,a):O},a.itemMargin=function(b){return arguments.length?(P=b,a):P},a.navMargin=function(b){return arguments.length?(Q=b,a):Q},a.height=function(b){return arguments.length?(u=b,a):u},a.width=function(b){return arguments.length?(t=b,a):t},a.display=function(b){return arguments.length&&-1!=g.indexOf(b)?(D=b,a):D},a.labelFormat=function(b){return arguments.length?(o=b,a):o},a.tickFormat=function(b){return arguments.length?(x=b,a):x},a.allowZoom=function(b){return arguments.length?(y=b,a):y},a.maxZoom=function(b){return arguments.length?(I=b,a):I},a.hover=function(b){return arguments.length?(j=b,a):j},a.mouseover=function(b){return arguments.length?(k=b,a):k},a.mouseout=function(b){return arguments.length?(l=b,a):l},a.click=function(b){return arguments.length?(m=b,a):m},a.scroll=function(b){return arguments.length?(n=b,a):n},a.colors=function(b){return arguments.length?(B=b,a):B},a.beginning=function(c){return arguments.length?(E=c,a):E},a.ending=function(b){return arguments.length?(G=b,a):G},a.labelMargin=function(b){return arguments.length?(F=b,a):F},a.labelFloat=function(b){return arguments.length?(p=b,a):p},a.rotateTicks=function(b){return arguments.length?(K=b,a):K},a.stack=function(){return J=!J,a},a.relativeTime=function(){return L=!L,a},a.linearTime=function(){return M=!M,a},a.showBorderLine=function(){return X=!X,a},a.showBorderFormat=function(b){return arguments.length?(Y=b,a):Y},a.showBorderLineClass=function(b){return arguments.length?(Z=b,a):Z},a.showToday=function(){return T=!T,a},a.showTodayFormat=function(b){return arguments.length?(W=b,a):W},a.colorProperty=function(b){return arguments.length?(C=b,a):C},a.rowSeparators=function(b){return arguments.length?(v=b,a):v},a.background=function(b){return arguments.length?(w=b,a):w},a.showTimeAxis=function(){return R=!R,a},a.showAxisTop=function(){return S=!S,a},a.showAxisCalendarYear=function(){return aa=!aa,a},a.showTimeAxisTick=function(){return U=!U,a},a.fullLengthBackgrounds=function(){return N=!N,a},a.showTimeAxisTickFormat=function(b){return arguments.length?(V=b,a):V},a.showAxisHeaderBackground=function(b){return $=!$,b&&(z=b),a},a.xAxisClass=function(b){return arguments.length?(ba=b,a):ba},a.navigate=function(b,c){return arguments.length?(q=b,r=c,_=!_,a):[q,r]},a.version=function(){return"1.0.0"},a},Object.defineProperty(a,"__esModule",{value:!0})});