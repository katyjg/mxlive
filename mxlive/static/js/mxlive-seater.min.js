function initSampleSeater(){const a=d3.scaleOrdinal(d3.schemeSet1);$(".seat-container").each(function(){$(this).layoutContainer({detailed:true,labelled:true,loadable:false,prefix:"sscnt",on_complete:function(){$("#sample-seater svg.sample.occupied").removeClass("occupied").each(function(){let group=$('.group-selector[data-group="'+$(this).data("group")+'"]').data();$(this).find("> .envelope").attr("fill",a(group.selector))})}})});d3.selectAll(".group-chooser [data-selector]").style("color","black").style("background-color",function(){return a($(this).data("selector"))}).on("click",function(){let remove=(!$(this).hasClass("selected"));$(".group-selector.selected").removeClass("selected");$(this).toggleClass("selected",remove)});$(document).on("click","#sample-seater svg.sample",function(){let group=$(".group-selector.selected").data();if(group){if($(this).hasClass("empty")){$(this).removeClass("empty").attr("data-group",group.group).find(" > .envelope").attr("fill",a(group.selector))}else{$(this).addClass("empty").removeAttr("data-group")}}});$(".seater .badge[data-pk]").hover(function(){let group=$(".group-selector.selected").data();if(group){$(this).css("background-color",a(group.selector))}},function(){let group=$(".group-selector.selected").data();if(group){$(this).css("background-color","")}}).click(function(){let group=$(".group-selector.selected").data();if(group){let pins=$("#seats-for-"+$(this).data("pk")+" svg.sample");let to_add=pins.filter(".empty");let to_del=pins.filter("[data-group="+group.group+"]");if(to_add.length>0){to_add.removeClass("empty").attr("data-group",group.group).find("> .envelope").attr("fill",a(group.selector))}else{to_del.removeAttr("data-group").addClass("empty")}}});$("#save-seats").click(function(){let info=[];let btn=$(this);btn.html('<i class="ti ti-reload spin"></i>');$(".seat-container").each(function(){let cid=$(this).data("pk");$(this).find("svg.sample[data-group]").each(function(){info.push({group:$(this).data("group"),container:cid,location:$(this).data("loc")})})});$.ajax({type:"post",dataType:"json",url:btn.data("post-action"),data:{samples:JSON.stringify(info)},beforeSend:function(c,b){c.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"));console.log(info)},success:function(c,b,d){if(c.url){window.location.replace(c.url)}else{window.location.reload()}},error:function(){btn.shake();btn.html('<i class="ti ti-alert"></i>')}})})};