(function(a){var c=Math.pow,d=Math.abs,e=Math.round,f=Math.max;function b(b){var c=b.originalEvent.changedTouches[0];return a.extend(b,{type:g[b.type],which:1,pageX:c.pageX,pageY:c.pageY,screenX:c.screenX,screenY:c.screenY,clientX:c.clientX,clientY:c.clientY,isTouchEvent:!0})}var g={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},h=a.ui.mouse.prototype,i=a.ui.mouse.prototype._mouseInit;h._mouseInit=function(){var c=this;c._touchActive=!1,this.element.bind("touchstart."+this.widgetName,function(a){return c._touchActive=!0,c._mouseDown(b(a))});var c=this;this._mouseMoveDelegate=function(a){if(c._touchActive)return c._mouseMove(b(a))},this._mouseUpDelegate=function(a){if(c._touchActive)return c._touchActive=!1,c._mouseUp(b(a))},a(document).bind("touchmove."+this.widgetName,this._mouseMoveDelegate).bind("touchend."+this.widgetName,this._mouseUpDelegate),i.apply(this)};var j=function(a,b){return function(){return 0===arguments.length?b.apply(this):void a.apply(this,arguments)}},k={0:{marginLeft:0,marginTop:0,filter:"progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22=1, SizingMethod=\"auto expand\")"},90:{marginLeft:-1,marginTop:1,filter:"progid:DXImageTransform.Microsoft.Matrix(M11=0, M12=-1, M21=1, M22=0, SizingMethod=\"auto expand\")"},180:{marginLeft:0,marginTop:0,filter:"progid:DXImageTransform.Microsoft.Matrix(M11=-1, M12=0, M21=0, M22=-1, SizingMethod=\"auto expand\")"},270:{marginLeft:-1,marginTop:1,filter:"progid:DXImageTransform.Microsoft.Matrix(M11=0, M12=1, M21=-1, M22=0, SizingMethod=\"auto expand\")"}},l=jQuery.browser.msie&&8>=parseInt(jQuery.browser.version,10);a.widget("ui.diffviewer",a.ui.mouse,{widgetEventPrefix:"diffviewer",options:{zoom:"fit",zoom_base:100,zoom_max:800,zoom_min:25,zoom_delta:1.4,zoom_animation:!0,ui_disabled:!1,update_on_resize:!0,resFunc:function(b){return b},onZoom:jQuery.noop,onAfterZoom:jQuery.noop,onStartDrag:jQuery.noop,onDrag:jQuery.noop,onStopDrag:jQuery.noop,onMouseMove:jQuery.noop,onClick:jQuery.noop,onStartLoad:null,onFinishLoad:null},_create:function(){var b=this;this.dx=0,this.dy=0,this.dragged=!1,this.img_object={},this.zoom_object={},this._angle=0,this.current_zoom=this.options.zoom;null===this.options.src||(this.container=this.element,this._updateContainerInfo(),this.container.css("overflow","hidden"),!0==this.options.update_on_resize&&a(window).resize(function(){b._updateContainerInfo()}),this.img_object=new a.ui.diffviewer.ImageObject(this.options.zoom_animation),this.img_object.object().click(function(a){return b._click(a)}).mousewheel(function(a,c){var d=0<c?1:-1;return b.zoom_by(d),!1}).prependTo(this.container),this.container.bind("mousemove",function(a){return b.update_pos(a)}),this.loadImage(this.options.src),!this.options.ui_disabled&&this.createui(),this._mouseInit())},destroy:function(){this._mouseDestroy()},_updateContainerInfo:function(){let a=f(this.container.height(),this.container.width());this.options.height=a,this.options.width=a},loadImage:function(b){this.img_object.object().removeAttr("src").removeAttr("width").removeAttr("height").removeAttr("style");try{this.overview_object.hide()}catch(a){}this.overview_img=a("<img>").css({position:"absolute",bottom:"0px",left:"0px",width:"128px",height:"128px"}),this.overview_object=a("<div>").addClass("diffviewer_overview_img").addClass("diffviewer_common").click(function(a){return c.thumb_click(a)}).mousedown(function(a){return c.thumb_drag_start(a)}).mousemove(function(a){return c.thumb_drag(a)}).mouseup(function(a){return c.thumb_drag_end(a)}).appendTo(this.container),this.overview_img.appendTo(this.overview_object),this.overview_box=a("<div>").addClass("diffviewer_overview_box").addClass("diffviewer_common"),this.overview_box.appendTo(this.overview_object),this.current_zoom=this.options.zoom;var c=this;this._trigger("onStartLoad",0,b),this.img_object.load(b,function(){c.container.addClass("diffviewer_cursor"),"fit"==c.options.zoom?c.fit(!0):c.set_zoom(c.options.zoom,!0),c.options.onFinishLoad&&c._trigger("onFinishLoad",0,b)}),this.overview_img.attr("src",b),l&&(this.img_object.object().attr("src",b),this.img_object.object().attr("width","512px"),this.img_object.object().attr("height","512px"))},fit:function(a){var b=this.img_object.orig_width()/this.img_object.orig_height(),c=this.options.width/this.options.height,d=0;d=b>c?100*(this.options.width/this.img_object.orig_width()):100*(this.options.height/this.img_object.orig_height()),this.set_zoom(d,a)},center:function(){this.setCoords(-e((this.img_object.display_width()-this.options.width)/2),-e((this.img_object.display_height()-this.options.height)/2))},moveTo:function(a,b){var c=a-e(this.options.width/2),d=b-e(this.options.height/2),f=this.img_object.x()-c,g=this.img_object.y()-d;this.setCoords(f,g)},getContainerOffset:function(){return jQuery.extend({},this.container.offset())},setCoords:function(a,b){if(this.img_object.loaded()){var c=this._correctCoords(a,b);this.img_object.x(c.x),this.img_object.y(c.y),this.setBoxCoords(a,b)}},setBoxCoords:function(a,b){var c,e,f,g;c=126*a/this.img_object.display_width(),e=126*b/this.img_object.display_height(),f=126*this.options.width/this.img_object.display_width(),g=126*this.options.height/this.img_object.display_height(),0<c?c=0:d(c)>126-f&&(c=-(126-f)),0<e?e=0:d(e)>126-g&&(e=-(126-g)),this.overview_box.css("top",-e+"px").css("left",-c+"px").css("width",f+"px").css("height",g+"px")},_correctCoords:function(a,b){return a=parseInt(a,10),b=parseInt(b,10),0<b&&(b=0),0<a&&(a=0),b+this.img_object.display_height()<this.options.height&&(b=this.options.height-this.img_object.display_height()),a+this.img_object.display_width()<this.options.width&&(a=this.options.width-this.img_object.display_width()),this.img_object.display_width()<=this.options.width&&(a=-(this.img_object.display_width()-this.options.width)/2),this.img_object.display_height()<=this.options.height&&(b=-(this.img_object.display_height()-this.options.height)/2),{x:a,y:b}},containerToImage:function(a,b){var c={x:a-this.img_object.x(),y:b-this.img_object.y()};return c=this.img_object.toOriginalCoords(c),{x:m.descaleValue(c.x,this.current_zoom),y:m.descaleValue(c.y,this.current_zoom)}},imageToContainer:function(a,b){var c={x:m.scaleValue(a,this.current_zoom),y:m.scaleValue(b,this.current_zoom)};return this.img_object.toRealCoords(c)},_getMouseCoords:function(a){var b=this.img_object.object().offset(),c=m.descaleValue(a.pageX-b.left,this.current_zoom),d=m.descaleValue(a.pageY-b.top,this.current_zoom);return{x:c,y:d}},set_zoom:function(a,b){if(!1!=this._trigger("onZoom",0,a)&&this.img_object.loaded()){if(a<this.options.zoom_min?a=this.options.zoom_min:a>this.options.zoom_max&&(a=this.options.zoom_max),"fit"==this.current_zoom){var c=e(this.options.width/2+this.img_object.orig_width()/2),d=e(this.options.height/2+this.img_object.orig_height()/2);this.current_zoom=100}else var c=-this.img_object.x()+e(this.options.width/2),d=-this.img_object.y()+e(this.options.height/2);var f=m.scaleValue(this.img_object.orig_width(),a),g=m.scaleValue(this.img_object.orig_height(),a),h=m.scaleValue(m.descaleValue(c,this.current_zoom),a),i=m.scaleValue(m.descaleValue(d,this.current_zoom),a);h=this.options.width/2-h,i=this.options.height/2-i,this.img_object.display_width(f),this.img_object.display_height(g);var j=this._correctCoords(h,i),k=this;this.setBoxCoords(h,i),this.img_object.setImageProps(f,g,j.x,j.y,b,function(){k._trigger("onAfterZoom",0,a)}),this.current_zoom=a,this.update_status()}},zoom_by:function(a){var b=this.find_closest_zoom_rate(this.current_zoom),d=this.options.zoom_base*c(this.options.zoom_delta,b+a);0<a&&d<this.current_zoom&&(d*=this.options.zoom_delta),0>a&&d>this.current_zoom&&(d/=this.options.zoom_delta),this.set_zoom(d,!0)},angle:function(a,b){if(0===arguments.length)return this.img_object.angle();-270>a||270<a||0!=a%90||(b||(a+=this.img_object.angle()),0>a&&(a+=360),360<=a&&(a-=360),a===this.img_object.angle()||(this.img_object.angle(a),this.center(),this._trigger("angle",0,{angle:this.img_object.angle()})))},find_closest_zoom_rate:function(a){function b(a,b){return a/b}function e(a,b){return a*b}if(a==this.options.zoom_base)return 0;for(var f=a>this.options.zoom_base?e:b,g=a>this.options.zoom_base?1:-1,h=this.options.zoom_delta,i=1;d(f(this.options.zoom_base,c(h,i))-a)>d(f(this.options.zoom_base,c(h,i+1))-a);)i++;return g*i},update_status:function(){if(!this.options.ui_disabled){var a=e(100*this.img_object.display_height()/this.img_object.orig_height());if(a)try{this.zoom_object.html(a+"%")}catch(a){}}a>this.options.zoom_min+10?this.overview_object.show():this.overview_object.hide()},info:function(a,b){if(a)return"orig_width"===a||"orig_height"===a?b?0==this.img_object.angle()%180?this.img_object[a]():"orig_width"===a?this.img_object.orig_height():this.img_object.orig_width():this.img_object[a]():"display_width"===a||"display_height"===a||"angle"===a?this.img_object[a]():"zoom"===a?this.current_zoom:"src"===a?this.img_object.object().attr("src"):void 0},_mouseStart:function(b){return(a.ui.mouse.prototype._mouseStart.call(this,b),!1!==this._trigger("onStartDrag",0,this._getMouseCoords(b)))&&(this.container.addClass("diffviewer_drag_cursor"),this.dx=b.pageX-this.img_object.x(),this.dy=b.pageY-this.img_object.y(),!0)},_mouseCapture:function(){return!0},_handleMouseMove:function(a){this._trigger("onMouseMove",a,this._getMouseCoords(a))},_mouseDrag:function(b){a.ui.mouse.prototype._mouseDrag.call(this,b);var c=b.pageY-this.dy,d=b.pageX-this.dx;return this.setCoords(d,c),this._trigger("onDrag",b,this._getMouseCoords(b)),!1},_mouseStop:function(b){a.ui.mouse.prototype._mouseStop.call(this,b),this.container.removeClass("diffviewer_drag_cursor"),this._trigger("onStopDrag",0,this._getMouseCoords(b))},_click:function(a){this._trigger("onClick",0,this._getMouseCoords(a))},thumb_drag_start:function(){return this.dragged=!0,this.container.addClass("diffviewer_drag_cursor"),!1},thumb_drag:function(a){if(this.dragged){this.options.onDrag&&this.options.onDrag.call(this,this._getMouseCoords(a));var b,c,d=this.overview_img.offset();return b=(a.pageX-d.left)*this.img_object.display_width()/128-this.options.width/2,c=(a.pageY-d.top)*this.img_object.display_height()/128-this.options.height/2,this.setCoords(-b,-c),!1}},thumb_drag_end:function(){this.container.removeClass("diffviewer_drag_cursor"),this.dragged=!1},thumb_click:function(a){var b,c,d=this.overview_img.offset();return b=(a.pageX-d.left)*this.img_object.display_width()/128-this.options.width/2,c=(a.pageY-d.top)*this.img_object.display_height()/128-this.options.height/2,this.setCoords(-b,-c),!1},update_pos:function(a){var b=Math.sqrt,c=Math.min,e=this._getMouseCoords(a);return x=2*d(c(f(e.x,0),this.img_object.orig_width())/this.img_object.orig_width()-.5),y=2*d(c(f(e.y,0),this.img_object.orig_height())/this.img_object.orig_height()-.5),z=this.options.resFunc.call(this,b(x*x+y*y)),z=z.toFixed(2),this.zoom_object.html("<span>Res: "+z+" &#8491;</span>"),!0},createui:function(){var b=this;a("<div>",{class:"diffviewer_zoom_in diffviewer_common diffviewer_button"}).bind("mousedown touchstart",function(){return b.zoom_by(1),!1}).html("<i class=\"ti ti-zoom-in\"></i>").attr("title","Zoom In").appendTo(this.container),a("<div>",{class:"diffviewer_zoom_out diffviewer_common diffviewer_button"}).bind("mousedown touchstart",function(){return b.zoom_by(-1),!1}).html("<i class=\"ti ti-zoom-out\"></i>").attr("title","Zoom Out").appendTo(this.container),a("<div>",{class:"diffviewer_zoom_fit diffviewer_common diffviewer_button"}).bind("mousedown touchstart",function(){return b.fit(this),!1}).html("<i class=\"ti ti-reload\"></i>").attr("title","Reset Zoom").appendTo(this.container),this.zoom_object=a("<div>").addClass("diffviewer_zoom_status diffviewer_common").appendTo(this.container),this.update_status()}}),a.ui.diffviewer.ImageObject=function(b){this._img=a("<img>").css({position:"absolute",top:"0px",left:"0px"}),this._loaded=!1,this._swapDimensions=!1,this._do_anim=b||!1,this.x(0,!0),this.y(0,!0),this.angle(0)},function(){this._reset=function(a,b){this._angle=0,this._swapDimensions=!1,this.x(0),this.y(0),this.orig_width(a),this.orig_height(b),this.display_width(a),this.display_height(b)},this.loaded=function(){return this._loaded},this.load=function(a,b){var c=this;b=b||jQuery.noop,this._loaded=!1;var d=new Image;d.onload=function(){c._loaded=!0,c._reset(this.width,this.height),c._img[0].src=a,b()},d.src=a,this._img.removeAttr("src").removeAttr("width").removeAttr("height").removeAttr("style").css({position:"absolute",top:"0px",left:"0px"}),this.angle(0)},this._dimension=function(a,b){var c="_"+a+"_"+b,d="_"+a+"_"+("height"===b?"width":"height");return j(function(a){this[this._swapDimensions?c:d]=a},function(){return this[this._swapDimensions?c:d]})},this.display_width=this._dimension("display","width"),this.display_height=this._dimension("display","height"),this.display_diff=function(){return Math.floor(this.display_width()-this.display_height())},this.orig_width=this._dimension("orig","width"),this.orig_height=this._dimension("orig","height"),this.x=j(function(a,b){this._x=a,b||this._img.css("left",this._x+(this._swapDimensions?this.display_diff()/2:0)+"px")},function(){return this._x}),this.y=j(function(a,b){this._y=a,b||this._img.css("top",this._y-(this._swapDimensions?this.display_diff()/2:0)+"px")},function(){return this._y}),this.angle=j(function(a){var b=this._swapDimensions;if(this._angle=a,this._swapDimensions=0!=a%180,b!==this._swapDimensions){var c=this._swapDimensions?-1:1;this.x(this.x()-c*this.display_diff()/2,!0),this.y(this.y()+c*this.display_diff()/2,!0)}var d=this._img;jQuery.each(["","-webkit-","-moz-","-o-","-ms-"],function(b,c){d.css(c+"transform","rotate("+a+"deg)")}),l&&(jQuery.each(["-ms-",""],function(b,c){d.css(c+"filter",k[a].filter)}),d.css({marginLeft:k[a].marginLeft*this.display_diff()/2,marginTop:k[a].marginTop*this.display_diff()/2}))},function(){return this._angle}),this.toOriginalCoords=function(a){switch(this.angle()){case 0:return{x:a.x,y:a.y};case 90:return{x:a.y,y:this.display_width()-a.x};case 180:return{x:this.display_width()-a.x,y:this.display_height()-a.y};case 270:return{x:this.display_height()-a.y,y:a.x};}},this.toRealCoords=function(a){switch(this.angle()){case 0:return{x:this.x()+a.x,y:this.y()+a.y};case 90:return{x:this.x()+this.display_width()-a.y,y:this.y()+a.x};case 180:return{x:this.x()+this.display_width()-a.x,y:this.y()+this.display_height()-a.y};case 270:return{x:this.x()+a.y,y:this.y()+this.display_height()-a.x};}},this.object=j(jQuery.noop,function(){return this._img}),this.setImageProps=function(a,b,c,d,e,f){f=f||jQuery.noop,this.display_width(a),this.display_height(b),this.x(c,!0),this.y(d,!0);var g=this._swapDimensions?b:a,i=this._swapDimensions?a:b,h={width:g,height:i,top:d-(this._swapDimensions?this.display_diff()/2:0)+"px",left:c+(this._swapDimensions?this.display_diff()/2:0)+"px"};l&&jQuery.extend(h,{marginLeft:k[this.angle()].marginLeft*this.display_diff()/2,marginTop:k[this.angle()].marginTop*this.display_diff()/2});var j=this._swapDimensions,m=this._img;if(l&&j){var n=this._img.width(),o=this._img.height(),p=h.height-n;iedw=h.width-o,delete h.width,delete h.height}this._do_anim&&!e?this._img.animate(h,{duration:200,complete:f,step:function(a,b){if(l&&j&&"top"===b.prop){var c=(a-b.start)/(b.end-b.start);m.height(n+p*c),m.width(o+iedw*c),m.css("top",a)}}}):(this._img.css(h),setTimeout(f,0))}}.apply(a.ui.diffviewer.ImageObject.prototype);var m={scaleValue:function(a,b){return a*b/100},descaleValue:function(a,b){return 100*a/b}}})(jQuery,void 0);