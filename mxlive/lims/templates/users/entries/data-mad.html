{% extends "users/entries/data.html" %}

{% load data_server %}
{% load static %}
{% load jsutils %}

{% block data_content %}
    {% mad_report as mad %}
    <div class="row">
        <div class="col-12 col-lg-9">
            <div id="mad-report" class="w-100 p-0"></div>
            <script>
                // create variables for annotations
                var choices{{ data.pk }} = {{ mad.choices | safe}};
                var report{{ data.pk }}={{ mad.report | safe }};
            </script>
        </div>
        {% if mad.choices %}
            <div class="col-12 col-lg-3 pb-4 text-condensed">
                <table class="table w-100 table-hover table-sm">
                    <thead>
                    <tr>
                        <th>Choice</th>
                        <th>Energy</th>
                        <th>f'</th>
                        <th>f''</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for choice in mad.choices %}
                        <tr style="color: {{ element.color }};">
                            <td>{{ choice.label }}</td>
                            <td title="{{ choice.wavelength|floatformat:3 }} Ã…">{{ choice.energy|floatformat:3 }} keV</td>
                            <td>{{ choice.fp|floatformat:2 }}</td>
                            <td>{{ choice.fpp|floatformat:2 }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <br/>
                <table class="table w-100 table-hover table-sm">
                    <thead>
                    <tr>
                        <th>Meta Data</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for key, value in data.get_meta_data.items %}
                        <tr>
                            <td>{{ key | title }}</td>
                            <td>{{ value }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block modal_assets %}
    <link href="{% static "css/c3.min.css" %}" rel="stylesheet">
    <link href="{% static "css/reports.min.css" %}" rel="stylesheet">
    <script type="text/javascript" src="{% static "js/d3/d3.v5.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/d3/d3.legend.js" %}"></script>
    <script type="text/javascript" src="{% static 'js/d3/d3.timeline.min.js' %}"></script>
    <script type="text/javascript" src="{% static "js/misc/showdown.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/misc/c3.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/mxlive-reports.v2.min.js" %}"></script>
{% endblock %}

{% block modal_scripts %}
    <script type="text/javascript">
        $('#modal').on('shown.bs.modal', function () {
            $('#mad-report').liveReport({
                data: report{{ data.pk }}
            });
        });
    </script>
{% endblock %}