{% extends "users/base.html" %}

{% load humanize static %}
{% load score_colors %}
{% load data_server %}
{% load icons %}
{% block extra_css %}
    <link href="{% static "css/reports.css" %}" rel="stylesheet">
{% endblock %}

{% block object_tools %}
    <div class="tools-box">
        {% if object.url %}
        <a  href="{% url 'files-proxy' section='archive' path=object.download_url %}" download="{{ object.name }}.tar.gz" title="Download all output files">
            {% show_icon label="Download" icon="ti ti-1x ti-download" %}
        </a>
        {% else %}
            <a class="text-muted not-allowed" title="Download Not Available">
                {% show_icon label="Download" icon="ti ti-1x ti-download" %}
            </a>
        {% endif %}
    </div>
{% endblock %}

{% block object_status %}
    <div class="status-bar">
        <div class="row">
            <div class="col-1">
                <h3 class="m-0">
                    <span title="Score"
                          class="badge score" style="text-shadow: 0 0 3px rgba(0, 0, 0, 0.7); color: #fff; background-color: {{ object.score|score_color }};"
                    >{{ object.score|floatformat:2 }}</span>
                </h3>
            </div>
            <div class="col">
                <small class="text-muted text-condensed">Session:</small><br>
                {% for session in object.sessions %}
                    <a href="{% url "session-detail" session.pk %}">{{ session.name }}</a>
                    {% if not forloop.last %}<span class="text-muted"> | </span>{% endif %}
                {% empty %}
                    <span class="text-muted">Unrecorded Session</span>
                {% endfor %}
                {% if object.session %}
                    <a href="{% url "session-detail" object.session.pk %}">{{ object.session.name }}</a>
                {% endif %}
            </div>
            <div class="col">
                <small class="text-muted text-condensed">Data:</small><br>
                {% for data in object.data.all %}<a data-url="{% url "data-detail" data.pk %}">{{ data.name }}</a>{% if not forloop.last %}<span class="text-muted"> | </span>{% endif %}{% endfor %}
            </div>
            <div class="col">
                <small class="text-muted text-condensed">Uploaded:</small><br>
                {{ object.modified }}
            </div>
        </div>
    </div>
    {% include "users/comments.html" with object=object %}
{% endblock %}

{% block page_heading %}
    <h3 class="text-condensed narrow-heading overflow ellipsis">
        <i class="text-muted ti ti-bar-chart-alt"></i>
        <span class="text-muted">{% if user.is_superuser %}{{ object.project|upper }} | {% endif %}</span><strong>{{ object.name }}</strong>
    </h3>
    <span class="text-muted">
        {{ object.kind }} Report uploaded from the beamline
    </span>
{% endblock %}

{% block full %}
    {% include "users/entries/report-builder.html" %}
{% endblock %}
