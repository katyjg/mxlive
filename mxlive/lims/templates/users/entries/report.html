{% extends "users/base.html" %}

{% load humanize static %}
{% load score_colors %}
{% load data_server %}

{% block extra_css %}
    <link href="{% static "css/reports.css" %}" rel="stylesheet">
{% endblock %}

{% block object_tools %}
    <div class="box-tools pull-right">
        {% if object.url %}
        <a class="pull-right" href="{{ object.download_url }}" download="{{ object.name }}.tar.gz" title="Download all output files">
            <span class="pull-right">
                <i class="fa fa-fw fa-2x fa-download"></i><br>
                <span class="tool-label">Download</span>
            </span>
        </a>
        {% else %}
            <span class="pull-right text-muted not-allowed" title="Download Not Available">
                <i class="fa fa-fw fa-2x fa-download"></i><br>
                <span class="tool-label">Download</span>
            </span>
        {% endif %}
    </div>
{% endblock %}

{% block object_status %}
    <div class="status-bar">
        <div class="row">
            <div class="col-xs-2">
                <h3 class="no-vmargin">
                    <span title="Score" class="label label-{{ object.score|label_score }}">{{ object.score|floatformat:2 }}</span>
                </h3>
            </div>
            <div class="col-xs-3">
                <small class="text-muted text-condensed">Session:</small><br>
                {% for session in object.sessions %}
                    <a href="{% url "session-detail" session.pk %}">{{ session.name }}</a>
                    {% if not forloop.last %}<span class="text-muted"> | </span>{% endif %}
                {% empty %}
                    <span class="text-muted">Unrecorded Session</span>
                {% endfor %}
                {% if object.session %}
                    <a href="{% url "session-detail" object.session.pk %}">{{ object.session.name }}</a>
                {% endif %}
            </div>
            <div class="col-xs-4">
                <small class="text-muted text-condensed">Data:</small><br>
                {% for data in object.data.all %}<a data-url="{% url "data-detail" data.pk %}">{{ data.name }}</a>{% if not forloop.last %}<span class="text-muted"> | </span>{% endif %}{% endfor %}
            </div>
            <div class="col-xs-3 text-right">
                <small class="text-muted text-condensed">Uploaded:</small><br>
                {{ object.modified }}
            </div>
        </div>
    </div>
    {% include "users/comments.html" with object=object %}
{% endblock %}

{% block page_heading %}
    <h3 class="text-condensed narrow-heading overflow ellipsis">
        <i class="text-muted fa fa-fw fa-area-chart"></i>
        <span class="text-muted">{% if user.is_superuser %}{{ object.project }} | {% endif %}{{ object.identity }} | </span><strong>{{ object.name }}</strong>
    </h3>
    <span class="text-muted">
        {{ object.kind }} Report uploaded from the beamline
    </span>
{% endblock %}

{% block full %}
    {% include "users/entries/report-builder.html" %}
{% endblock %}